{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar Promise = require(\"promise\");\nvar ethers = require(\"ethers\");\nvar txDecoder = require(\"ethereum-tx-decoder\");\nvar abi = require(\"ethereumjs-abi\");\nvar _require = require(\"./util\"),\n  toJSONRPCPayload = _require.toJSONRPCPayload;\nvar _require2 = require(\"./abis\"),\n  eip2771BaseAbi = _require2.eip2771BaseAbi;\nvar _require3 = require(\"./config\"),\n  config = _require3.config,\n  RESPONSE_CODES = _require3.RESPONSE_CODES,\n  EVENTS = _require3.EVENTS,\n  BICONOMY_RESPONSE_CODES = _require3.BICONOMY_RESPONSE_CODES,\n  STATUS = _require3.STATUS;\nvar DEFAULT_PAYLOAD_ID = \"99999999\";\nvar baseURL = config.baseURL;\nvar JSON_RPC_VERSION = config.JSON_RPC_VERSION;\nvar NATIVE_META_TX_URL = config.nativeMetaTxUrl;\nvar PermitClient = require(\"./PermitClient\");\nvar ERC20ForwarderClient = require(\"./ERC20ForwarderClient\");\nvar BiconomyWalletClient = require(\"./BiconomyWalletClient\");\nvar _require4 = require(\"./biconomyforwarder\"),\n  buildForwardTxRequest = _require4.buildForwardTxRequest,\n  getDomainSeperator = _require4.getDomainSeperator;\nvar _require5 = require(\"./abis\"),\n  erc20ForwarderAbi = _require5.erc20ForwarderAbi,\n  oracleAggregatorAbi = _require5.oracleAggregatorAbi,\n  feeManagerAbi = _require5.feeManagerAbi,\n  biconomyForwarderAbi = _require5.biconomyForwarderAbi,\n  transferHandlerAbi = _require5.transferHandlerAbi;\nvar fetch = require(\"cross-fetch\");\nvar interfaceMap = {},\n  smartContractMap = {},\n  smartContractMetaTransactionMap = {},\n  smartContractTrustedForwarderMap = {};\nvar biconomyForwarder;\nvar events = require(\"events\");\nvar eventEmitter = new events.EventEmitter();\nvar trustedForwarderOverhead;\nvar daiPermitOverhead;\nvar eip2612PermitOverhead;\nvar domainType, forwarderDomainType, metaInfoType, relayerPaymentType, metaTransactionType, forwardRequestType; //domaindata would be sourced from forwarder -> domain details mapping\n\nvar domainData = {\n  name: config.eip712DomainName,\n  version: config.eip712SigVersion,\n  verifyingContract: config.eip712VerifyingContract\n};\nvar daiDomainData = {\n  name: config.daiDomainName,\n  version: config.daiVersion\n};\nvar forwarderDomainData, forwarderDomainDetails; // EIP712 format data for login\n\nvar loginDomainType, loginMessageType, loginDomainData;\nfunction Biconomy(provider, options) {\n  _validate(options);\n  this.isBiconomy = true;\n  this.status = STATUS.INIT;\n  this.options = options;\n  this.apiKey = options.apiKey;\n  this.isLogin = false;\n  this.dappAPIMap = {};\n  this.strictMode = options.strictMode || false;\n  this.providerId = options.providerId || 0;\n  this.readViaContract = options.readViaContract || false;\n  this.READY = STATUS.BICONOMY_READY;\n  this.LOGIN_CONFIRMATION = EVENTS.LOGIN_CONFIRMATION;\n  this.ERROR = EVENTS.BICONOMY_ERROR;\n  this.pendingLoginTransactions = {};\n  this.jsonRPC = {\n    messageId: 0\n  };\n  this.originalProvider = provider;\n  this.isEthersProviderPresent = false;\n  this.canSignMessages = false;\n  if (options.debug) {\n    config.logsEnabled = true;\n  }\n  if (options.walletProvider) {\n    if (isEthersProvider(options.walletProvider)) {\n      throw new Error(\"Wallet Provider in options can't be an ethers provider. Please pass the provider you get from your wallet directly.\");\n    }\n    this.walletProvider = new ethers.providers.Web3Provider(options.walletProvider);\n  }\n  if (provider) {\n    if (isEthersProvider(provider)) {\n      this.ethersProvider = provider;\n      this.isEthersProviderPresent = true;\n    } else {\n      this.ethersProvider = new ethers.providers.Web3Provider(provider);\n    }\n    _init(this.apiKey, this);\n    var proto = Object.getPrototypeOf(provider);\n    var keys = Object.getOwnPropertyNames(proto);\n    for (var i = 0; i < keys.length; i++) {\n      this[keys[i]] = provider[keys[i]];\n    }\n    for (var key in provider) {\n      if (!this[key]) {\n        this[key] = provider[key];\n      }\n    }\n    var self = this;\n    this.send = function (payload, cb) {\n      var _this = this;\n      if (typeof payload === \"string\") {\n        // Ethers provider is being used to call methods, so payload is actually method, and cb is params\n        payload = {\n          id: 1,\n          jsonrpc: \"2.0\",\n          method: payload,\n          params: cb\n        };\n      }\n      if (payload.method == \"eth_sendTransaction\") {\n        return new Promise(function (resolve, reject) {\n          handleSendTransaction(_this, payload, function (error, result) {\n            var response = _this._createJsonRpcResponse(payload, error, result);\n            if (cb && !self.isEthersProviderPresent) {\n              cb(error, response);\n            }\n            if (response.error) {\n              reject(response.error);\n            } else {\n              resolve(response.result);\n            }\n          });\n        });\n      } else if (payload.method == \"eth_sendRawTransaction\") {\n        return new Promise(function (resolve, reject) {\n          sendSignedTransaction(_this, payload, function (error, result) {\n            var response = _this._createJsonRpcResponse(payload, error, result);\n            if (cb && !self.isEthersProviderPresent) {\n              cb(error, response);\n            }\n            if (response.error) {\n              reject(response.error);\n            } else {\n              resolve(response.result);\n            }\n          });\n        });\n      } else {\n        if (self.isEthersProviderPresent) {\n          return self.originalProvider.send(payload.method, payload.params);\n        } else {\n          self.originalProvider.send(payload, cb);\n        }\n      }\n    };\n    this.request = function (args, cb) {\n      var payload = {\n        method: args.method,\n        params: args.params\n      };\n      if (payload.method == \"eth_sendTransaction\") {\n        return new Promise(function (resolve, reject) {\n          handleSendTransaction(self, payload, function (error, result) {\n            if (error) {\n              return reject(error);\n            }\n            if (result.result) {\n              resolve(result.result);\n              _logMessage(result.result);\n            } else {\n              resolve(result);\n              _logMessage(result);\n            }\n            if (cb) {\n              cb(error, result);\n            }\n          });\n        });\n      } else if (payload.method == \"eth_sendRawTransaction\") {\n        return new Promise(function (resolve, reject) {\n          sendSignedTransaction(self, payload, function (error, result) {\n            if (error) {\n              return reject(error);\n            }\n            if (result.result) {\n              resolve(result.result);\n              _logMessage(result.result);\n            } else {\n              resolve(result);\n              _logMessage(result);\n            }\n            if (cb) {\n              cb(error, result);\n            }\n          });\n        });\n      } else {\n        if (self.originalProvider.request) {\n          return self.originalProvider.request(args, cb);\n        } else if (self.originalProvider.send) {\n          return new Promise( /*#__PURE__*/function () {\n            var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(resolve, reject) {\n              var jsonRPCPaylod, localResult;\n              return _regenerator[\"default\"].wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      jsonRPCPaylod = toJSONRPCPayload(self, payload.method, payload.params);\n                      if (!self.isEthersProviderPresent) {\n                        _context.next = 14;\n                        break;\n                      }\n                      _context.prev = 2;\n                      _context.next = 5;\n                      return self.originalProvider.send(jsonRPCPaylod.method, jsonRPCPaylod.params);\n                    case 5:\n                      localResult = _context.sent;\n                      resolve(localResult);\n                      _context.next = 12;\n                      break;\n                    case 9:\n                      _context.prev = 9;\n                      _context.t0 = _context[\"catch\"](2);\n                      reject(_context.t0);\n                    case 12:\n                      _context.next = 15;\n                      break;\n                    case 14:\n                      self.originalProvider.send(jsonRPCPaylod, function (err, response) {\n                        if (err) {\n                          return reject(err);\n                        }\n                        if (response.result) {\n                          resolve(response.result);\n                        } else {\n                          resolve(response);\n                        }\n                      });\n                    case 15:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee, null, [[2, 9]]);\n            }));\n            return function (_x, _x2) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n        } else {\n          return Promise.reject(\"Invalid provider object passed to Biconomy as it doesn't support request or send method\");\n        }\n      }\n    };\n    this.sendAsync = this.send;\n  } else {\n    throw new Error(\"Please pass a provider to Biconomy.\");\n  }\n}\nBiconomy.prototype.getSignerByAddress = function (userAddress) {\n  var provider = this.getEthersProvider();\n  var signer = provider.getSigner();\n  signer = signer.connectUnchecked();\n  signer.getAddress = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", userAddress);\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return signer;\n};\nBiconomy.prototype.getEthersProvider = function () {\n  return new ethers.providers.Web3Provider(this);\n}; //TODO\n//Allow to provide custom txGas\n\nBiconomy.prototype.getForwardRequestAndMessageToSign = function (rawTransaction, tokenAddress, customBatchId, customDomainName, customDomainVersion, cb) {\n  try {\n    var engine = this;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(resolve, reject) {\n        var decodedTx, to, methodInfo, error, methodName, token, api, metaTxApproach, contractAddr, _error, parsedTransaction, account, gasLimit, gasLimitNum, contractABI, contract, _contract$estimateGas, _error2, request, cost, forwarderToUse, buildTxResponse, _error3, domainDataToUse, eip712DataToSign, hashToSign, dataToSign, _error4;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!rawTransaction) {\n                  _context3.next = 80;\n                  break;\n                }\n                decodedTx = txDecoder.decodeTx(rawTransaction);\n                if (!(decodedTx.to && decodedTx.data && decodedTx.value)) {\n                  _context3.next = 77;\n                  break;\n                }\n                to = decodedTx.to.toLowerCase();\n                methodInfo = decodeMethod(to, decodedTx.data);\n                if (methodInfo) {\n                  _context3.next = 9;\n                  break;\n                }\n                error = formatMessage(RESPONSE_CODES.DASHBOARD_DATA_MISMATCH, \"Smart Contract address registered on dashboard is different than what is sent(\".concat(decodedTx.to, \") in current transaction\"));\n                if (cb) cb(error);\n                return _context3.abrupt(\"return\", reject(error));\n              case 9:\n                methodName = methodInfo.name; //token address needs to be passed otherwise fees will be charged in DAI by default, given DAI permit is given\n\n                token = tokenAddress ? tokenAddress : engine.daiTokenAddress;\n                _logMessage(tokenAddress);\n                api = engine.dappAPIMap[to] ? engine.dappAPIMap[to][methodName] : undefined;\n                if (!api) {\n                  api = engine.dappAPIMap[config.SCW] ? engine.dappAPIMap[config.SCW][methodName] : undefined;\n                  metaTxApproach = smartContractMetaTransactionMap[config.SCW];\n                } else {\n                  contractAddr = api.contractAddress.toLowerCase();\n                  metaTxApproach = smartContractMetaTransactionMap[contractAddr];\n                }\n                if (api) {\n                  _context3.next = 19;\n                  break;\n                }\n                _logMessage(\"API not found for method \".concat(methodName));\n                _error = formatMessage(RESPONSE_CODES.API_NOT_FOUND, \"No API found on dashboard for called method \".concat(methodName));\n                if (cb) cb(_error);\n                return _context3.abrupt(\"return\", reject(_error));\n              case 19:\n                _logMessage(\"API found\");\n                parsedTransaction = ethers.utils.parseTransaction(rawTransaction);\n                account = parsedTransaction.from;\n                _logMessage(\"Signer is \".concat(account));\n                gasLimit = decodedTx.gasLimit;\n                if (!(!gasLimit || parseInt(gasLimit) == 0)) {\n                  _context3.next = 41;\n                  break;\n                }\n                contractABI = smartContractMap[to];\n                if (!contractABI) {\n                  _context3.next = 39;\n                  break;\n                }\n                contract = new ethers.Contract(to, JSON.parse(contractABI), engine.ethersProvider);\n                _context3.prev = 28;\n                _context3.next = 31;\n                return (_contract$estimateGas = contract.estimateGas)[methodInfo.signature].apply(_contract$estimateGas, (0, _toConsumableArray2[\"default\"])(methodInfo.args).concat([{\n                  from: account\n                }]));\n              case 31:\n                gasLimit = _context3.sent;\n                _context3.next = 37;\n                break;\n              case 34:\n                _context3.prev = 34;\n                _context3.t0 = _context3[\"catch\"](28);\n                return _context3.abrupt(\"return\", reject(_context3.t0));\n              case 37:\n                // Do not send this value in API call. only meant for txGas\n                gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).add(ethers.BigNumber.from(5000)).toNumber();\n                _logMessage(\"Gas limit number \".concat(gasLimitNum));\n              case 39:\n                _context3.next = 42;\n                break;\n              case 41:\n                gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).toNumber();\n              case 42:\n                if (account) {\n                  _context3.next = 45;\n                  break;\n                }\n                _error2 = formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Not able to get user account from signed transaction\");\n                return _context3.abrupt(\"return\", end(_error2));\n              case 45:\n                if (!(metaTxApproach == engine.TRUSTED_FORWARDER)) {\n                  _context3.next = 54;\n                  break;\n                }\n                _context3.next = 48;\n                return findTheRightForwarder(engine, to);\n              case 48:\n                forwarderToUse = _context3.sent;\n                _context3.next = 51;\n                return buildForwardTxRequest(account, to, gasLimitNum, decodedTx.data, biconomyForwarder.attach(forwarderToUse), customBatchId);\n              case 51:\n                request = _context3.sent.request;\n                _context3.next = 64;\n                break;\n              case 54:\n                if (!(metaTxApproach == engine.ERC20_FORWARDER)) {\n                  _context3.next = 61;\n                  break;\n                }\n                _context3.next = 57;\n                return engine.erc20ForwarderClient.buildTx({\n                  userAddress: account,\n                  to: to,\n                  txGas: gasLimitNum,\n                  data: decodedTx.data,\n                  token: token\n                });\n              case 57:\n                buildTxResponse = _context3.sent;\n                if (buildTxResponse) {\n                  request = buildTxResponse.request;\n                  cost = buildTxResponse.cost;\n                } else {\n                  reject(formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Unable to build forwarder request\"));\n                }\n                _context3.next = 64;\n                break;\n              case 61:\n                _error3 = formatMessage(RESPONSE_CODES.INVALID_OPERATION, \"Smart contract is not registered in the dashboard for this meta transaction approach. Kindly use biconomy.getUserMessageToSign\");\n                if (cb) cb(_error3);\n                return _context3.abrupt(\"return\", reject(_error3));\n              case 64:\n                _logMessage(\"Forward Request is: \");\n                _logMessage(request); // Update the verifyingContract field of domain data based on the current request\n\n                forwarderDomainData.verifyingContract = forwarderToUse;\n                domainDataToUse = forwarderDomainDetails[forwarderToUse];\n                if (customDomainName) {\n                  domainDataToUse.name = customDomainName.toString();\n                }\n                if (customDomainVersion) {\n                  domainDataToUse.version = customDomainVersion.toString();\n                }\n                eip712DataToSign = {\n                  types: {\n                    EIP712Domain: forwarderDomainType,\n                    ERC20ForwardRequest: forwardRequestType\n                  },\n                  domain: domainDataToUse,\n                  primaryType: \"ERC20ForwardRequest\",\n                  message: request\n                };\n                hashToSign = abi.soliditySHA3([\"address\", \"address\", \"address\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"bytes32\"], [request.from, request.to, request.token, request.txGas, request.tokenGasPrice, request.batchId, request.batchNonce, request.deadline, ethers.utils.keccak256(request.data)]);\n                dataToSign = {\n                  eip712Format: eip712DataToSign,\n                  personalSignatureFormat: hashToSign,\n                  request: request,\n                  cost: cost\n                };\n                if (cb) cb(null, dataToSign);\n                return _context3.abrupt(\"return\", resolve(dataToSign));\n              case 77:\n                _error4 = formatMessage(RESPONSE_CODES.BICONOMY_NOT_INITIALIZED, \"Decoders not initialized properly in mexa sdk. Make sure your have smart contracts registered on Mexa Dashboard\");\n                if (cb) cb(_error4);\n                return _context3.abrupt(\"return\", reject(_error4));\n              case 80:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[28, 34]]);\n      }));\n      return function (_x3, _x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  } catch (error) {\n    return end(error);\n  }\n};\n/**\n * Method used to listen to events emitted from the SDK\n */\n\nBiconomy.prototype.onEvent = function (type, callback) {\n  if (type == this.READY || type == this.ERROR || type == this.LOGIN_CONFIRMATION) {\n    eventEmitter.on(type, callback);\n    return this;\n  } else {\n    throw formatMessage(RESPONSE_CODES.EVENT_NOT_SUPPORTED, \"\".concat(type, \" event is not supported.\"));\n  }\n};\n/**\n * Create a JSON RPC response from the given error and result parameter.\n **/\n\nBiconomy.prototype._createJsonRpcResponse = function (payload, error, result) {\n  var response = {};\n  response.id = payload.id;\n  response.jsonrpc = JSON_RPC_VERSION;\n  if ((!error || error == null) && !result) {\n    response.error = \"Unexpected error has occurred. Please contact Biconomy Team\";\n    return response;\n  }\n  if (error) {\n    response.error = error;\n  } else if (result && result.error) {\n    response.error = result.error;\n  } else if (ethers.utils.isHexString(result)) {\n    response.result = result;\n  } else {\n    response = result;\n  }\n  return response;\n};\nfunction decodeMethod(to, data) {\n  if (to && data && interfaceMap[to]) {\n    return interfaceMap[to].parseTransaction({\n      data: data\n    });\n  }\n  return;\n}\n/**\n * Method used to handle transaction initiated using web3.eth.sendSignedTransaction method\n * It extracts rawTransaction from payload and decode it to get required information like from, to,\n * data, gasLimit to create the payload for biconomy meta transaction API.\n * In case of Native meta transaction, payload just contains rawTransaction\n * In case of contract based meta transaction, payload contains rawTransaction and signature wrapped\n * in a json object.\n *\n * @param {Object} engine Reference to this SDK instance\n * @param {Object} payload Payload data\n * @param {Function} end Callback function with error as first argument\n */\n\nfunction sendSignedTransaction(_x5, _x6, _x7) {\n  return _sendSignedTransaction.apply(this, arguments);\n}\n/**\n * Function decodes the parameter in payload and gets the user signature using eth_signTypedData_v4\n * method and send the request to biconomy for processing and call the callback method 'end'\n * with transaction hash.\n *\n * This is an internal function that is called while intercepting eth_sendTransaction RPC method call.\n **/\n\nfunction _sendSignedTransaction() {\n  _sendSignedTransaction = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(engine, payload, end) {\n    var data, rawTransaction, signature, request, signatureType, customDomainName, customDomainVersion, decodedTx, to, methodInfo, error, methodName, api, metaTxApproach, contractAddr, _error5, paramArray, parsedTransaction, account, _error6, forwardedData, gasLimitNum, gasLimit, contractABI, _contract$estimateGas2, contract, forwarderToUse, domainDataToUse, domainSeparator, _data, _data2, relayerPayment, _data3, _error7, _error8, _error9, _error10;\n    return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            if (!(payload && payload.params[0])) {\n              _context7.next = 114;\n              break;\n            }\n            data = payload.params[0];\n\n            // user would need to pass token address as well!\n            // OR they could pass the symbol and engine will provide the address for you..\n            // default is DAI\n            if (typeof data == \"string\") {\n              // Here user send the rawTransaction in the payload directly. Probably the case of native meta transaction\n              // Handle this scenario differently?\n              rawTransaction = data;\n            } else if ((0, _typeof2[\"default\"])(data) == \"object\") {\n              // Here user wrapped raw Transaction in json object along with signature\n              signature = data.signature;\n              rawTransaction = data.rawTransaction;\n              signatureType = data.signatureType;\n              request = data.forwardRequest;\n              customDomainName = data.domainName;\n              customDomainVersion = data.domainVersion;\n            }\n            if (!rawTransaction) {\n              _context7.next = 109;\n              break;\n            }\n            decodedTx = txDecoder.decodeTx(rawTransaction);\n            if (!(decodedTx.to && decodedTx.data && decodedTx.value)) {\n              _context7.next = 104;\n              break;\n            }\n            to = decodedTx.to.toLowerCase();\n            methodInfo = decodeMethod(to, decodedTx.data);\n            if (methodInfo) {\n              _context7.next = 25;\n              break;\n            }\n            methodInfo = decodeMethod(config.SCW, decodedTx.data);\n            if (methodInfo) {\n              _context7.next = 25;\n              break;\n            }\n            if (!engine.strictMode) {\n              _context7.next = 16;\n              break;\n            }\n            error = formatMessage(RESPONSE_CODES.DASHBOARD_DATA_MISMATCH, \"No smart contract wallet or smart contract registered on dashboard with address (\".concat(decodedTx.to, \")\"));\n            return _context7.abrupt(\"return\", end(error));\n          case 16:\n            _logMessage(\"Strict mode is off so falling back to default provider for handling transaction\");\n            if ((0, _typeof2[\"default\"])(data) == \"object\" && data.rawTransaction) {\n              payload.params = [data.rawTransaction];\n            }\n            _context7.prev = 18;\n            return _context7.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"No smart contract wallet or smart contract registered on dashboard with address (\".concat(decodedTx.to, \")\")));\n          case 22:\n            _context7.prev = 22;\n            _context7.t0 = _context7[\"catch\"](18);\n            return _context7.abrupt(\"return\", end(_context7.t0));\n          case 25:\n            methodName = methodInfo.name;\n            api = engine.dappAPIMap[to] ? engine.dappAPIMap[to][methodName] : undefined;\n            if (!api) {\n              api = engine.dappAPIMap[config.SCW] ? engine.dappAPIMap[config.SCW][methodName] : undefined;\n              metaTxApproach = smartContractMetaTransactionMap[config.SCW];\n            } else {\n              contractAddr = api.contractAddress.toLowerCase();\n              metaTxApproach = smartContractMetaTransactionMap[contractAddr];\n            }\n            if (api) {\n              _context7.next = 45;\n              break;\n            }\n            _logMessage(\"API not found for method \".concat(methodName));\n            _logMessage(\"Strict mode \".concat(engine.strictMode));\n            if (!engine.strictMode) {\n              _context7.next = 36;\n              break;\n            }\n            _error5 = formatMessage(RESPONSE_CODES.API_NOT_FOUND, \"Biconomy strict mode is on. No registered API found for method \".concat(methodName, \". Please register API from developer dashboard.\"));\n            return _context7.abrupt(\"return\", end(_error5, null));\n          case 36:\n            _logMessage(\"Falling back to default provider as strict mode is false in biconomy\");\n            if ((0, _typeof2[\"default\"])(data) == \"object\" && data.rawTransaction) {\n              payload.params = [data.rawTransaction];\n            }\n            _context7.prev = 38;\n            return _context7.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"Current provider can not sign transactions. Make sure to register method \".concat(methodName, \" on Biconomy Dashboard\")));\n          case 42:\n            _context7.prev = 42;\n            _context7.t1 = _context7[\"catch\"](38);\n            return _context7.abrupt(\"return\", end(_context7.t1));\n          case 45:\n            _logMessage(\"API found\");\n            paramArray = [];\n            parsedTransaction = ethers.utils.parseTransaction(rawTransaction);\n            account = parsedTransaction ? parsedTransaction.from : undefined;\n            _logMessage(\"signer is \".concat(account));\n            if (account) {\n              _context7.next = 53;\n              break;\n            }\n            _error6 = formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Not able to get user account from signed transaction\");\n            return _context7.abrupt(\"return\", end(_error6));\n          case 53:\n            gasLimit = decodedTx.gasLimit;\n            if (!(api.url == NATIVE_META_TX_URL)) {\n              _context7.next = 101;\n              break;\n            }\n            if (!(metaTxApproach != engine.DEFAULT)) {\n              _context7.next = 90;\n              break;\n            }\n\n            // forwardedData = payload.params[0].data;\n            forwardedData = decodedTx.data;\n            if (!(!gasLimit || parseInt(gasLimit) == 0)) {\n              _context7.next = 68;\n              break;\n            }\n            contractABI = smartContractMap[to];\n            if (!contractABI) {\n              _context7.next = 66;\n              break;\n            }\n            contract = new ethers.Contract(to, JSON.parse(contractABI), engine.ethersProvider);\n            _context7.next = 63;\n            return (_contract$estimateGas2 = contract.estimateGas)[methodInfo.signature].apply(_contract$estimateGas2, (0, _toConsumableArray2[\"default\"])(methodInfo.args).concat([{\n              from: account\n            }]));\n          case 63:\n            gasLimit = _context7.sent;\n            // do not send this value in API call. only meant for txGas\n            gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).add(ethers.BigNumber.from(5000)).toNumber();\n            _logMessage(\"gas limit number\" + gasLimitNum);\n          case 66:\n            _context7.next = 69;\n            break;\n          case 68:\n            gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).toNumber();\n          case 69:\n            _logMessage(request);\n            paramArray.push(request);\n            _context7.next = 73;\n            return findTheRightForwarder(engine, to);\n          case 73:\n            forwarderToUse = _context7.sent;\n            //Update the verifyingContract in domain data\n            forwarderDomainData.verifyingContract = forwarderToUse;\n            domainDataToUse = forwarderDomainDetails[forwarderToUse];\n            if (customDomainName) {\n              domainDataToUse.name = customDomainName.toString();\n            }\n            if (customDomainVersion) {\n              domainDataToUse.version = customDomainVersion.toString();\n            } // Update the verifyingContract field of domain data based on the current request\n\n            if (signatureType && signatureType == engine.EIP712_SIGN) {\n              domainSeparator = getDomainSeperator(domainDataToUse);\n              _logMessage(domainSeparator);\n              paramArray.push(domainSeparator);\n            }\n            paramArray.push(signature);\n            _data = {};\n            _data.from = account;\n            _data.apiId = api.id;\n            _data.params = paramArray;\n            _data.to = to;\n            if (signatureType && signatureType == engine.EIP712_SIGN) {\n              _data.signatureType = engine.EIP712_SIGN;\n            }\n            _context7.next = 88;\n            return _sendTransaction(engine, account, api, _data, end, payload);\n          case 88:\n            _context7.next = 99;\n            break;\n          case 90:\n            paramArray.push.apply(paramArray, (0, _toConsumableArray2[\"default\"])(methodInfo.args));\n            _data2 = {};\n            _data2.from = account;\n            _data2.apiId = api.id;\n            _data2.params = paramArray;\n            _data2.gasLimit = decodedTx.gasLimit.toString(); //verify\n\n            _data2.to = decodedTx.to.toLowerCase();\n            _context7.next = 99;\n            return _sendTransaction(engine, account, api, _data2, end, payload);\n          case 99:\n            _context7.next = 102;\n            break;\n          case 101:\n            if (signature) {\n              relayerPayment = {};\n              relayerPayment.token = config.DEFAULT_RELAYER_PAYMENT_TOKEN_ADDRESS;\n              relayerPayment.amount = config.DEFAULT_RELAYER_PAYMENT_AMOUNT;\n              _data3 = {};\n              _data3.rawTx = rawTransaction;\n              _data3.signature = signature;\n              _data3.to = to;\n              _data3.from = account;\n              _data3.apiId = api.id;\n              _data3.data = decodedTx.data;\n              _data3.value = ethers.utils.hexValue(decodedTx.value);\n              _data3.gasLimit = decodedTx.gasLimit.toString();\n              _data3.nonceBatchId = config.NONCE_BATCH_ID;\n              _data3.expiry = config.EXPIRY;\n              _data3.baseGas = config.BASE_GAS;\n              _data3.relayerPayment = {\n                token: relayerPayment.token,\n                amount: relayerPayment.amount\n              };\n              _sendTransaction(engine, account, api, _data3, end, payload);\n            } else {\n              _error7 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload.params[0]), \". message and signature are required in param object\"));\n              eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error7);\n              end(_error7);\n            }\n          case 102:\n            _context7.next = 107;\n            break;\n          case 104:\n            _error8 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Not able to deode the data in rawTransaction using ethereum-tx-decoder. Please check the data sent.\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error8);\n            end(_error8);\n          case 107:\n            _context7.next = 112;\n            break;\n          case 109:\n            _error9 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload.params[0]), \".rawTransaction is required in param object\"));\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error9);\n            end(_error9);\n          case 112:\n            _context7.next = 117;\n            break;\n          case 114:\n            _error10 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload.params[0]), \". Non empty Array expected in params key\"));\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error10);\n            end(_error10);\n          case 117:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, null, [[18, 22], [38, 42]]);\n  }));\n  return _sendSignedTransaction.apply(this, arguments);\n}\nfunction handleSendTransaction(_x8, _x9, _x10) {\n  return _handleSendTransaction.apply(this, arguments);\n}\nfunction _handleSendTransaction() {\n  _handleSendTransaction = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee8(engine, payload, end) {\n    var to, methodInfo, error, methodName, api, metaTxApproach, customBatchId, webHookAttributes, customDomainName, customDomainVersion, signTypedDataType, contractAddr, gasLimit, txGas, signatureType, _error11, account, paramArray, _error12, forwardedData, gasLimitNum, signatureFromPayload, contractABI, _contract$estimateGas3, contract, _error13, forwarderToAttach, request, domainDataToUse, domainSeparator, signatureEIP712, signaturePersonal, data, _data4, _error14, _error15, _error16;\n    return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            _context8.prev = 0;\n            _logMessage(\"Handle transaction with payload\");\n            _logMessage(payload);\n            if (!(payload.params && payload.params[0] && payload.params[0].to)) {\n              _context8.next = 171;\n              break;\n            }\n            to = payload.params[0].to.toLowerCase();\n            if (!(interfaceMap[to] || interfaceMap[config.SCW])) {\n              _context8.next = 155;\n              break;\n            }\n            methodInfo = decodeMethod(to, payload.params[0].data); // Check if the Smart Contract Wallet is registered on dashboard\n\n            if (!methodInfo) {\n              methodInfo = decodeMethod(config.SCW, payload.params[0].data);\n            }\n            if (methodInfo) {\n              _context8.next = 13;\n              break;\n            }\n            error = {};\n            error.code = RESPONSE_CODES.WRONG_ABI;\n            error.message = \"Can't decode method information from payload. Make sure you have uploaded correct ABI on Biconomy Dashboard\";\n            return _context8.abrupt(\"return\", end(error, null));\n          case 13:\n            methodName = methodInfo.name;\n            api = engine.dappAPIMap[to] ? engine.dappAPIMap[to][methodName] : undefined; // Information we get here is contractAddress, methodName, methodType, ApiId\n\n            if (!api) {\n              api = engine.dappAPIMap[config.SCW] ? engine.dappAPIMap[config.SCW][methodName] : undefined;\n              metaTxApproach = smartContractMetaTransactionMap[config.SCW];\n            } else {\n              contractAddr = api.contractAddress.toLowerCase();\n              metaTxApproach = smartContractMetaTransactionMap[contractAddr];\n            } //Sanitise gas limit here. big number / hex / number -> hex\n\n            gasLimit = payload.params[0].gas || payload.params[0].gasLimit;\n            if (gasLimit) {\n              gasLimit = ethers.BigNumber.from(gasLimit.toString()).toHexString();\n            }\n            txGas = payload.params[0].txGas;\n            signatureType = payload.params[0].signatureType;\n            if (payload.params[0].batchId) {\n              customBatchId = Number(payload.params[0].batchId);\n            }\n            if (payload.params[0].webHookAttributes) {\n              webHookAttributes = payload.params[0].webHookAttributes;\n            }\n            if (payload.params[0].domainName) {\n              customDomainName = payload.params[0].domainName;\n            }\n            if (payload.params[0].domainVersion) {\n              customDomainVersion = payload.params[0].domainVersion;\n            }\n            if (payload.params[0].signTypedDataType) {\n              signTypedDataType = payload.params[0].signTypedDataType;\n            }\n            _logMessage(payload.params[0]);\n            _logMessage(api);\n            _logMessage(\"gas limit : \".concat(gasLimit));\n            if (txGas) {\n              _logMessage(\"tx gas supplied : \".concat(txGas));\n            }\n            if (api) {\n              _context8.next = 47;\n              break;\n            }\n            _logMessage(\"API not found for method \".concat(methodName));\n            _logMessage(\"Strict mode \".concat(engine.strictMode));\n            if (!engine.strictMode) {\n              _context8.next = 39;\n              break;\n            }\n            _error11 = {};\n            _error11.code = RESPONSE_CODES.API_NOT_FOUND;\n            _error11.message = \"Biconomy strict mode is on. No registered API found for method \".concat(methodName, \". Please register API from developer dashboard.\");\n            return _context8.abrupt(\"return\", end(_error11, null));\n          case 39:\n            _logMessage(\"Falling back to default provider as strict mode is false in biconomy\");\n            _context8.prev = 40;\n            return _context8.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"No registered API found for method \".concat(methodName, \". Please register API from developer dashboard.\")));\n          case 44:\n            _context8.prev = 44;\n            _context8.t0 = _context8[\"catch\"](40);\n            return _context8.abrupt(\"return\", end(_context8.t0));\n          case 47:\n            _logMessage(\"API found\");\n            _logMessage(\"Getting user account\");\n            account = payload.params[0].from;\n            if (account) {\n              _context8.next = 52;\n              break;\n            }\n            return _context8.abrupt(\"return\", end(\"Not able to get user account\"));\n          case 52:\n            _logMessage(\"User account fetched\");\n            _logMessage(methodInfo.args);\n            paramArray = [];\n            if (!(metaTxApproach == engine.ERC20_FORWARDER)) {\n              _context8.next = 59;\n              break;\n            }\n            _error12 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"This operation is not allowed for contracts registered on dashboard as \\\"ERC20Forwarder\\\". Use ERC20Forwarder client instead!\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error12);\n            return _context8.abrupt(\"return\", end(_error12));\n          case 59:\n            if (!(api.url == NATIVE_META_TX_URL)) {\n              _context8.next = 150;\n              break;\n            }\n            if (!(metaTxApproach == engine.TRUSTED_FORWARDER)) {\n              _context8.next = 139;\n              break;\n            }\n            _logMessage(\"Smart contract is configured to use Trusted Forwarder as meta transaction type\");\n            forwardedData = payload.params[0].data;\n            signatureFromPayload = payload.params[0].signature; // Check if txGas is present, if not calculate gas limit for txGas\n\n            if (!(!txGas || parseInt(txGas) == 0)) {\n              _context8.next = 80;\n              break;\n            }\n            contractABI = smartContractMap[to];\n            if (!contractABI) {\n              _context8.next = 75;\n              break;\n            }\n            contract = new ethers.Contract(to, JSON.parse(contractABI), engine.ethersProvider);\n            _context8.next = 70;\n            return (_contract$estimateGas3 = contract.estimateGas)[methodInfo.signature].apply(_contract$estimateGas3, (0, _toConsumableArray2[\"default\"])(methodInfo.args).concat([{\n              from: account\n            }]));\n          case 70:\n            txGas = _context8.sent;\n            // do not send this value in API call. only meant for txGas\n            gasLimitNum = ethers.BigNumber.from(txGas.toString()).add(ethers.BigNumber.from(5000)).toNumber();\n            _logMessage(\"Gas limit (txGas) calculated for method \".concat(methodName, \" in SDK: \").concat(gasLimitNum));\n            _context8.next = 78;\n            break;\n          case 75:\n            _error13 = formatMessage(RESPONSE_CODES.SMART_CONTRACT_NOT_FOUND, \"Smart contract ABI not found!\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error13);\n            end(_error13);\n          case 78:\n            _context8.next = 83;\n            break;\n          case 80:\n            _logMessage(\"txGas supplied for this Trusted Forwarder call is \".concat(Number(txGas)));\n            gasLimitNum = ethers.BigNumber.from(txGas.toString()).toNumber();\n            _logMessage(\"gas limit number for txGas \" + gasLimitNum);\n          case 83:\n            _context8.next = 85;\n            return findTheRightForwarder(engine, to);\n          case 85:\n            forwarderToAttach = _context8.sent;\n            _context8.next = 88;\n            return buildForwardTxRequest(account, to, parseInt(gasLimitNum),\n            //txGas\n            forwardedData, biconomyForwarder.attach(forwarderToAttach), customBatchId);\n          case 88:\n            request = _context8.sent.request;\n            _logMessage(request);\n            paramArray.push(request);\n            forwarderDomainData.verifyingContract = forwarderToAttach;\n            domainDataToUse = forwarderDomainDetails[forwarderToAttach];\n            if (customDomainName) {\n              domainDataToUse.name = customDomainName.toString();\n            }\n            if (customDomainVersion) {\n              domainDataToUse.version = customDomainVersion.toString();\n            }\n            if (!(signatureType && signatureType == engine.EIP712_SIGN)) {\n              _context8.next = 113;\n              break;\n            }\n            _logMessage(\"EIP712 signature flow\"); // Update the verifyingContract field of domain data based on the current request\n\n            domainSeparator = getDomainSeperator(domainDataToUse);\n            _logMessage(\"Domain separator to be used:\");\n            _logMessage(domainSeparator);\n            paramArray.push(domainSeparator);\n            if (!signatureFromPayload) {\n              _context8.next = 106;\n              break;\n            }\n            signatureEIP712 = signatureFromPayload;\n            _logMessage(\"EIP712 signature from payload is \".concat(signatureEIP712));\n            _context8.next = 110;\n            break;\n          case 106:\n            _context8.next = 108;\n            return getSignatureEIP712(engine, account, request, forwarderToAttach, domainDataToUse, signTypedDataType);\n          case 108:\n            signatureEIP712 = _context8.sent;\n            _logMessage(\"EIP712 signature is \".concat(signatureEIP712));\n          case 110:\n            paramArray.push(signatureEIP712);\n            _context8.next = 128;\n            break;\n          case 113:\n            _logMessage(\"Personal signature flow\");\n            if (!signatureFromPayload) {\n              _context8.next = 119;\n              break;\n            }\n            signaturePersonal = signatureFromPayload;\n            _logMessage(\"Personal signature from payload is \".concat(signaturePersonal));\n            _context8.next = 123;\n            break;\n          case 119:\n            _context8.next = 121;\n            return getSignaturePersonal(engine, request);\n          case 121:\n            signaturePersonal = _context8.sent;\n            _logMessage(\"Personal signature is \".concat(signaturePersonal));\n          case 123:\n            if (!signaturePersonal) {\n              _context8.next = 127;\n              break;\n            }\n            paramArray.push(signaturePersonal);\n            _context8.next = 128;\n            break;\n          case 127:\n            throw new Error(\"Could not get personal signature while processing transaction in Mexa SDK. Please check the providers you have passed to Biconomy\");\n          case 128:\n            data = {};\n            data.from = account;\n            data.apiId = api.id;\n            data.params = paramArray;\n            data.to = to; //gasLimit for entire transaction\n            //This will be calculated at the backend again\n\n            data.gasLimit = gasLimit;\n            if (signatureType && signatureType == engine.EIP712_SIGN) {\n              data.signatureType = engine.EIP712_SIGN;\n            }\n            _context8.next = 137;\n            return _sendTransaction(engine, account, api, data, end, payload);\n          case 137:\n            _context8.next = 148;\n            break;\n          case 139:\n            paramArray.push.apply(paramArray, (0, _toConsumableArray2[\"default\"])(methodInfo.args));\n            _data4 = {};\n            _data4.from = account;\n            _data4.apiId = api.id;\n            _data4.params = paramArray;\n            _data4.gasLimit = gasLimit;\n            _data4.to = to;\n            _data4.webHookAttributes = webHookAttributes;\n            _sendTransaction(engine, account, api, _data4, end, payload);\n          case 148:\n            _context8.next = 153;\n            break;\n          case 150:\n            _error14 = formatMessage(RESPONSE_CODES.INVALID_OPERATION, \"Biconomy smart contract wallets are not supported now. On dashboard, re-register your smart contract methods with \\\"native meta tx\\\" checkbox selected.\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error14);\n            return _context8.abrupt(\"return\", end(_error14));\n          case 153:\n            _context8.next = 169;\n            break;\n          case 155:\n            if (!engine.strictMode) {\n              _context8.next = 161;\n              break;\n            }\n            _error15 = formatMessage(RESPONSE_CODES.BICONOMY_NOT_INITIALIZED, \"Decoders not initialized properly in mexa sdk. Make sure your have smart contracts registered on Mexa Dashboard\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error15);\n            end(_error15);\n            _context8.next = 169;\n            break;\n          case 161:\n            _logMessage(\"Smart contract not found on dashbaord. Strict mode is off, so falling back to normal transaction mode\");\n            _context8.prev = 162;\n            return _context8.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"Current provider can't send transactions and smart contract \".concat(to, \" not found on Biconomy Dashbaord\")));\n          case 166:\n            _context8.prev = 166;\n            _context8.t1 = _context8[\"catch\"](162);\n            return _context8.abrupt(\"return\", end(_context8.t1));\n          case 169:\n            _context8.next = 174;\n            break;\n          case 171:\n            _error16 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload), \". Expecting params key to be an array with first element having a 'to' property\"));\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error16);\n            end(_error16);\n          case 174:\n            _context8.next = 179;\n            break;\n          case 176:\n            _context8.prev = 176;\n            _context8.t2 = _context8[\"catch\"](0);\n            return _context8.abrupt(\"return\", end(_context8.t2));\n          case 179:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8, null, [[0, 176], [40, 44], [162, 166]]);\n  }));\n  return _handleSendTransaction.apply(this, arguments);\n}\nfunction callDefaultProvider(_x11, _x12, _x13, _x14) {\n  return _callDefaultProvider.apply(this, arguments);\n}\nfunction _callDefaultProvider() {\n  _callDefaultProvider = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee9(engine, payload, callback, errorMessage) {\n    var targetProvider, responseFromProvider;\n    return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            _context9.prev = 0;\n            targetProvider = getTargetProvider(engine);\n            if (!targetProvider) {\n              _context9.next = 15;\n              break;\n            }\n            if (!isEthersProvider(targetProvider)) {\n              _context9.next = 12;\n              break;\n            }\n            _context9.next = 6;\n            return targetProvider.send(payload.method, payload.params);\n          case 6:\n            responseFromProvider = _context9.sent;\n            _logMessage(\"Response from original provider\", responseFromProvider);\n            callback(null, responseFromProvider);\n            return _context9.abrupt(\"return\", responseFromProvider);\n          case 12:\n            return _context9.abrupt(\"return\", targetProvider.send(payload, callback));\n          case 13:\n            _context9.next = 17;\n            break;\n          case 15:\n            _logMessage(\"No provider present in Biconomy that can sign messages\");\n            throw new Error(errorMessage);\n          case 17:\n            _context9.next = 24;\n            break;\n          case 19:\n            _context9.prev = 19;\n            _context9.t0 = _context9[\"catch\"](0);\n            _logMessage(\"Unexpected error occured when calling default provider\");\n            _logMessage(_context9.t0);\n            return _context9.abrupt(\"return\", callback(_context9.t0));\n          case 24:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9, null, [[0, 19]]);\n  }));\n  return _callDefaultProvider.apply(this, arguments);\n}\nfunction _getEIP712ForwardMessageToSign(request, forwarder, domainData) {\n  // Update the verifyingContract field of domain data based on the current request\n  if (!forwarderDomainType || !forwardRequestType || !forwarderDomainData || !forwarder) {\n    throw new Error(\"Biconomy is not properly initialized\");\n  }\n  if (!forwarderDomainDetails || Object.keys(forwarderDomainDetails).length === 0) {\n    throw new Error(\"Biconomy is not properly initialized\");\n  } //Override domainData\n\n  var domainDataToUse = domainData; //Might update version as well\n\n  var dataToSign = JSON.stringify({\n    types: {\n      EIP712Domain: forwarderDomainType,\n      ERC20ForwardRequest: forwardRequestType\n    },\n    domain: domainDataToUse,\n    primaryType: \"ERC20ForwardRequest\",\n    message: request\n  });\n  return dataToSign;\n}\nfunction _getPersonalForwardMessageToSign(request) {\n  return abi.soliditySHA3([\"address\", \"address\", \"address\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"bytes32\"], [request.from, request.to, request.token, request.txGas, request.tokenGasPrice, request.batchId, request.batchNonce, request.deadline, ethers.utils.keccak256(request.data)]);\n}\nfunction getTargetProvider(engine) {\n  var provider;\n  if (engine) {\n    provider = engine.originalProvider;\n    if (!engine.canSignMessages) {\n      if (!engine.walletProvider) {\n        //comment this out and just log\n        //throw new Error(`Please pass a provider connected to a wallet that can sign messages in Biconomy options.`);\n        _logMessage(\"Please pass a provider connected to a wallet that can sign messages in Biconomy options\");\n      } else {\n        provider = engine.walletProvider;\n      }\n    }\n  }\n  return provider;\n}\nfunction getSignatureParameters(signature) {\n  if (!ethers.utils.isHexString(signature)) {\n    throw new Error('Given value \"'.concat(signature, '\" is not a valid hex string.'));\n  }\n  var r = signature.slice(0, 66);\n  var s = \"0x\".concat(signature.slice(66, 130));\n  var v = \"0x\".concat(signature.slice(130, 132));\n  v = ethers.BigNumber.from(v).toNumber();\n  if (![27, 28].includes(v)) v += 27;\n  return {\n    r: r,\n    s: s,\n    v: v\n  };\n}\nfunction findTheRightForwarder(_x15, _x16) {\n  return _findTheRightForwarder.apply(this, arguments);\n} //take parameter for chosen signature type V3 or V4\n\nfunction _findTheRightForwarder() {\n  _findTheRightForwarder = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee10(engine, to) {\n    var forwarderToUse, ethersProvider, contract, supportedForwarders, forwarder, i, isTrustedForwarder;\n    return _regenerator[\"default\"].wrap(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            if (!smartContractTrustedForwarderMap[to]) {\n              _context10.next = 4;\n              break;\n            }\n            forwarderToUse = smartContractTrustedForwarderMap[to];\n            _context10.next = 41;\n            break;\n          case 4:\n            if (engine.isEthersProviderPresent) {\n              ethersProvider = engine.originalProvider;\n            } else {\n              ethersProvider = new ethers.providers.Web3Provider(engine.originalProvider);\n            }\n            contract = new ethers.Contract(to, eip2771BaseAbi, ethersProvider);\n            supportedForwarders = engine.forwarderAddresses;\n            forwarderToUse = engine.forwarderAddress; //default forwarder\n            // Attempt to find out forwarder that 'to' contract trusts\n\n            _context10.prev = 8;\n            _context10.next = 11;\n            return contract.trustedForwarder();\n          case 11:\n            forwarder = _context10.sent;\n            _context10.next = 18;\n            break;\n          case 14:\n            _context10.prev = 14;\n            _context10.t0 = _context10[\"catch\"](8);\n            _logMessage(\"Could not find read method 'trustedForwarder' in the contract abi\");\n            _logMessage(_context10.t0);\n          case 18:\n            i = 0;\n          case 19:\n            if (!(i < supportedForwarders.length)) {\n              _context10.next = 40;\n              break;\n            }\n            if (!forwarder) {\n              _context10.next = 24;\n              break;\n            }\n            if (!(supportedForwarders[i].toString() == forwarder.toString())) {\n              _context10.next = 24;\n              break;\n            }\n            forwarderToUse = supportedForwarders[i];\n            return _context10.abrupt(\"break\", 40);\n          case 24:\n            _context10.prev = 24;\n            _context10.next = 27;\n            return contract.isTrustedForwarder(supportedForwarders[i]);\n          case 27:\n            isTrustedForwarder = _context10.sent;\n            if (!isTrustedForwarder) {\n              _context10.next = 31;\n              break;\n            }\n            forwarderToUse = supportedForwarders[i];\n            return _context10.abrupt(\"break\", 40);\n          case 31:\n            _context10.next = 37;\n            break;\n          case 33:\n            _context10.prev = 33;\n            _context10.t1 = _context10[\"catch\"](24);\n            _logMessage(\"Could not find read method 'isTrustedForwarder' in the contract abi\");\n            _logMessage(_context10.t1);\n          case 37:\n            i++;\n            _context10.next = 19;\n            break;\n          case 40:\n            smartContractTrustedForwarderMap[to] = forwarderToUse;\n          case 41:\n            return _context10.abrupt(\"return\", forwarderToUse);\n          case 42:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, _callee10, null, [[8, 14], [24, 33]]);\n  }));\n  return _findTheRightForwarder.apply(this, arguments);\n}\nfunction getSignatureEIP712(engine, account, request, forwarder, domainData, type) {\n  //default V4 now   \n  var signTypedDataType = \"eth_signTypedData_v4\";\n  if (type === \"v3\" || type === \"V3\") {\n    signTypedDataType = \"eth_signTypedData_v3\";\n  }\n  var dataToSign = _getEIP712ForwardMessageToSign(request, forwarder, domainData);\n  var targetProvider = getTargetProvider(engine);\n  if (!targetProvider) {\n    throw new Error(\"Unable to get provider information passed to Biconomy\");\n  }\n  var promise = new Promise( /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(resolve, reject) {\n      var signature, _getSignatureParamete, r, s, v, newSignature;\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!targetProvider) {\n                _context4.next = 21;\n                break;\n              }\n              if (!isEthersProvider(targetProvider)) {\n                _context4.next = 17;\n                break;\n              }\n              _context4.prev = 2;\n              _context4.next = 5;\n              return targetProvider.send(signTypedDataType, [account, dataToSign]);\n            case 5:\n              signature = _context4.sent;\n              _getSignatureParamete = getSignatureParameters(signature), r = _getSignatureParamete.r, s = _getSignatureParamete.s, v = _getSignatureParamete.v;\n              v = ethers.BigNumber.from(v).toHexString();\n              newSignature = r + s.slice(2) + v.slice(2);\n              resolve(newSignature);\n              _context4.next = 15;\n              break;\n            case 12:\n              _context4.prev = 12;\n              _context4.t0 = _context4[\"catch\"](2);\n              reject(_context4.t0);\n            case 15:\n              _context4.next = 19;\n              break;\n            case 17:\n              _context4.next = 19;\n              return targetProvider.send({\n                jsonrpc: \"2.0\",\n                id: 999999999999,\n                method: signTypedDataType,\n                params: [account, dataToSign]\n              }, function (error, res) {\n                if (error) {\n                  reject(error);\n                } else {\n                  var oldSignature = res.result;\n                  var _getSignatureParamete2 = getSignatureParameters(oldSignature),\n                    _r = _getSignatureParamete2.r,\n                    _s = _getSignatureParamete2.s,\n                    _v = _getSignatureParamete2.v;\n                  _v = ethers.BigNumber.from(_v).toHexString();\n                  var _newSignature = _r + _s.slice(2) + _v.slice(2);\n                  resolve(_newSignature);\n                }\n              });\n            case 19:\n              _context4.next = 22;\n              break;\n            case 21:\n              reject(\"Could not get signature from the provider passed to Biconomy. Check if you have passed a walletProvider in Biconomy Options.\");\n            case 22:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[2, 12]]);\n    }));\n    return function (_x17, _x18) {\n      return _ref4.apply(this, arguments);\n    };\n  }());\n  return promise;\n}\nfunction getSignaturePersonal(_x19, _x20) {\n  return _getSignaturePersonal.apply(this, arguments);\n} // On getting smart contract data get the API data also\n\nfunction _getSignaturePersonal() {\n  _getSignaturePersonal = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee12(engine, req) {\n    var hashToSign, signature, targetProvider, providerWithSigner, signer, promise;\n    return _regenerator[\"default\"].wrap(function _callee12$(_context12) {\n      while (1) {\n        switch (_context12.prev = _context12.next) {\n          case 0:\n            hashToSign = _getPersonalForwardMessageToSign(req);\n            if (!(!engine.signer && !engine.walletProvider)) {\n              _context12.next = 3;\n              break;\n            }\n            throw new Error(\"Can't sign messages with current provider. Did you forget to pass walletProvider in Biconomy options?\");\n          case 3:\n            targetProvider = getTargetProvider(engine);\n            if (targetProvider) {\n              _context12.next = 6;\n              break;\n            }\n            throw new Error(\"Unable to get provider information passed to Biconomy\");\n          case 6:\n            if (isEthersProvider(targetProvider)) {\n              providerWithSigner = targetProvider;\n            } else {\n              providerWithSigner = new ethers.providers.Web3Provider(targetProvider);\n            }\n            signer = providerWithSigner.getSigner();\n            promise = new Promise( /*#__PURE__*/function () {\n              var _ref8 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee11(resolve, reject) {\n                var _getSignatureParamete3, r, s, v, newSignature;\n                return _regenerator[\"default\"].wrap(function _callee11$(_context11) {\n                  while (1) {\n                    switch (_context11.prev = _context11.next) {\n                      case 0:\n                        _context11.prev = 0;\n                        _context11.next = 3;\n                        return signer.signMessage(ethers.utils.arrayify(hashToSign));\n                      case 3:\n                        signature = _context11.sent;\n                        _getSignatureParamete3 = getSignatureParameters(signature), r = _getSignatureParamete3.r, s = _getSignatureParamete3.s, v = _getSignatureParamete3.v;\n                        v = ethers.BigNumber.from(v).toHexString();\n                        newSignature = r + s.slice(2) + v.slice(2);\n                        resolve(newSignature);\n                        _context11.next = 13;\n                        break;\n                      case 10:\n                        _context11.prev = 10;\n                        _context11.t0 = _context11[\"catch\"](0);\n                        reject(_context11.t0);\n                      case 13:\n                      case \"end\":\n                        return _context11.stop();\n                    }\n                  }\n                }, _callee11, null, [[0, 10]]);\n              }));\n              return function (_x34, _x35) {\n                return _ref8.apply(this, arguments);\n              };\n            }());\n            return _context12.abrupt(\"return\", promise);\n          case 10:\n          case \"end\":\n            return _context12.stop();\n        }\n      }\n    }, _callee12);\n  }));\n  return _getSignaturePersonal.apply(this, arguments);\n}\neventEmitter.on(EVENTS.SMART_CONTRACT_DATA_READY, function (dappId, engine) {\n  // Get DApp API information from Database\n  var getAPIInfoAPI = \"\".concat(baseURL, \"/api/\").concat(config.version, \"/meta-api\");\n  fetch(getAPIInfoAPI, getFetchOptions(\"GET\", engine.apiKey)).then(function (response) {\n    return response.json();\n  }).then(function (response) {\n    if (response && response.listApis) {\n      var apiList = response.listApis;\n      for (var i = 0; i < apiList.length; i++) {\n        var contractAddress = apiList[i].contractAddress; // TODO: In case of SCW(Smart Contract Wallet) there'll be no contract address. Save SCW as key in that case.\n\n        if (contractAddress) {\n          if (!engine.dappAPIMap[contractAddress]) {\n            engine.dappAPIMap[contractAddress] = {};\n          }\n          engine.dappAPIMap[contractAddress][apiList[i].method] = apiList[i];\n        } else {\n          if (!engine.dappAPIMap[config.SCW]) {\n            engine.dappAPIMap[config.SCW] = {};\n          }\n          engine.dappAPIMap[config.SCW][apiList[i].method] = apiList[i];\n        }\n      }\n      eventEmitter.emit(EVENTS.DAPP_API_DATA_READY, engine);\n    }\n  })[\"catch\"](function (error) {\n    _logMessage(error);\n  });\n});\neventEmitter.on(EVENTS.HELPER_CLENTS_READY, /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(engine) {\n    var biconomyAttributes, targetProvider, ethersProvider, signer, signerOrProvider, isSignerWithAccounts, erc20ForwarderAddress, transferHandlerAddress, erc20Forwarder, oracleAggregatorAddress, feeManagerAddress, forwarderAddress, oracleAggregator, feeManager, forwarder, requiredDomainData, transferHandler, tokenGasPriceV1SupportedNetworks;\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            biconomyAttributes = {\n              apiKey: engine.apiKey,\n              dappAPIMap: engine.dappAPIMap,\n              interfaceMap: interfaceMap,\n              signType: {\n                EIP712_SIGN: engine.EIP712_SIGN,\n                PERSONAL_SIGN: engine.PERSONAL_SIGN\n              }\n            };\n            targetProvider = getTargetProvider(engine);\n            /*if(!targetProvider) {\n              throw new Error(`Unable to get provider information passed to Biconomy`);\n            }*/\n\n            if (engine.isEthersProviderPresent) {\n              ethersProvider = engine.originalProvider;\n            } else {\n              ethersProvider = new ethers.providers.Web3Provider(engine.originalProvider);\n            }\n            signer = ethersProvider.getSigner();\n            signerOrProvider = signer;\n            isSignerWithAccounts = true;\n            _context5.prev = 7;\n            _context5.next = 10;\n            return signer.getAddress();\n          case 10:\n            engine.canSignMessages = true;\n            _context5.next = 19;\n            break;\n          case 13:\n            _context5.prev = 13;\n            _context5.t0 = _context5[\"catch\"](7);\n            _logMessage(\"Given provider does not have accounts information\");\n            signerOrProvider = ethersProvider;\n            isSignerWithAccounts = false;\n            engine.canSignMessages = false;\n          case 19:\n            erc20ForwarderAddress = engine.options.erc20ForwarderAddress || engine.erc20ForwarderAddress;\n            transferHandlerAddress = engine.options.transferHandlerAddress || engine.transferHandlerAddress; // Has to be biconomy wrapped provider in order to make gasless calls!\n\n            if (engine.walletFactoryAddress) {\n              engine.biconomyWalletClient = new BiconomyWalletClient({\n                biconomyProvider: engine,\n                provider: ethersProvider,\n                targetProvider: targetProvider,\n                isSignerWithAccounts: isSignerWithAccounts,\n                biconomyAttributes: biconomyAttributes,\n                walletFactoryAddress: engine.walletFactoryAddress,\n                baseWalletAddress: engine.baseWalletAddress,\n                entryPointAddress: engine.entryPointAddress,\n                handlerAddress: engine.handlerAddress,\n                networkId: engine.networkId\n              });\n              _logMessage(engine.biconomyWalletClient);\n            }\n            if (!erc20ForwarderAddress) {\n              _context5.next = 45;\n              break;\n            }\n            erc20Forwarder = new ethers.Contract(erc20ForwarderAddress, erc20ForwarderAbi, signerOrProvider);\n            _context5.next = 26;\n            return erc20Forwarder.oracleAggregator();\n          case 26:\n            oracleAggregatorAddress = _context5.sent;\n            _context5.next = 29;\n            return erc20Forwarder.feeManager();\n          case 29:\n            feeManagerAddress = _context5.sent;\n            _context5.next = 32;\n            return erc20Forwarder.forwarder();\n          case 32:\n            forwarderAddress = _context5.sent;\n            oracleAggregator = new ethers.Contract(oracleAggregatorAddress, oracleAggregatorAbi, signerOrProvider);\n            feeManager = new ethers.Contract(feeManagerAddress, feeManagerAbi, signerOrProvider); //If ERC20 Forwarder Address exits then it would have configured Forwarder \n\n            forwarder = new ethers.Contract(forwarderAddress, biconomyForwarderAbi, signerOrProvider);\n            requiredDomainData = forwarderDomainDetails[forwarderAddress];\n            transferHandler = new ethers.Contract(transferHandlerAddress, transferHandlerAbi, signerOrProvider);\n            tokenGasPriceV1SupportedNetworks = engine.tokenGasPriceV1SupportedNetworks;\n            engine.permitClient = new PermitClient(engine, erc20ForwarderAddress, engine.daiTokenAddress); //TODO\n            //Review initialisation of ERC20 Forwarder as well!\n\n            engine.erc20ForwarderClient = new ERC20ForwarderClient({\n              forwarderClientOptions: biconomyAttributes,\n              networkId: engine.networkId,\n              provider: ethersProvider,\n              targetProvider: targetProvider,\n              forwarderDomainData: requiredDomainData,\n              forwarderDomainDetails: forwarderDomainDetails,\n              forwarderDomainType: forwarderDomainType,\n              erc20Forwarder: erc20Forwarder,\n              transferHandler: transferHandler,\n              forwarder: forwarder,\n              oracleAggregator: oracleAggregator,\n              feeManager: feeManager,\n              isSignerWithAccounts: isSignerWithAccounts,\n              tokenGasPriceV1SupportedNetworks: tokenGasPriceV1SupportedNetworks,\n              trustedForwarderOverhead: trustedForwarderOverhead,\n              daiPermitOverhead: daiPermitOverhead,\n              eip2612PermitOverhead: eip2612PermitOverhead\n            });\n            _logMessage(engine.permitClient);\n            _logMessage(engine.erc20ForwarderClient);\n            _context5.next = 46;\n            break;\n          case 45:\n            _logMessage(\"ERC20 Forwarder is not supported for this network\");\n          //Warning : you would not be able to use ERC20ForwarderClient and PermitClient \n\n          case 46:\n            engine.status = STATUS.BICONOMY_READY;\n            eventEmitter.emit(STATUS.BICONOMY_READY);\n            _context5.next = 53;\n            break;\n          case 50:\n            _context5.prev = 50;\n            _context5.t1 = _context5[\"catch\"](0);\n            _logMessage(_context5.t1);\n          case 53:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[0, 50], [7, 13]]);\n  }));\n  return function (_x21) {\n    return _ref5.apply(this, arguments);\n  };\n}());\neventEmitter.on(EVENTS.DAPP_API_DATA_READY, function (engine) {\n  eventEmitter.emit(EVENTS.HELPER_CLENTS_READY, engine);\n});\n/**\n * Get user account from current provider using eth_accounts method.\n **/\n\nfunction _getUserAccount(engine, payload, cb) {\n  if (engine) {\n    var id = DEFAULT_PAYLOAD_ID;\n    if (payload) {\n      id = payload.id;\n    }\n    if (cb) {\n      engine.originalProvider.send({\n        jsonrpc: JSON_RPC_VERSION,\n        id: id,\n        method: \"eth_accounts\",\n        params: []\n      }, function (error, response) {\n        cb(error, response);\n      });\n    } else {\n      return new Promise(function (resolve, reject) {\n        engine.originalProvider.send({\n          jsonrpc: JSON_RPC_VERSION,\n          id: id,\n          method: \"eth_accounts\",\n          params: []\n        }, function (error, res) {\n          if (error) {\n            reject(error);\n          } else if (!res.result) {\n            reject(\"Invalid response \".concat(res));\n          } else {\n            resolve(res.result[0]);\n          }\n        });\n      });\n    }\n  }\n}\n/**\n * Validate parameters passed to biconomy object. Dapp id and api key are mandatory.\n **/\n\nfunction _validate(options) {\n  if (!options) {\n    throw new Error(\"Options object needs to be passed to Biconomy Object with apiKey as mandatory key\");\n  }\n  if (!options.apiKey) {\n    throw new Error(\"apiKey is required in options object when creating Biconomy object\");\n  }\n}\n/**\n * Method to send the transaction to biconomy server and call the callback method\n * to pass the result of meta transaction to web3 function call.\n * @param engine Object representing biconomy provider engine\n * @param account User selected account on current wallet\n * @param api API object got from biconomy server\n * @param data Data to be sent to biconomy server having transaction data\n * @param cb Callback method to be called to pass result or send error\n **/\n\nfunction _sendTransaction(_x22, _x23, _x24, _x25, _x26, _x27) {\n  return _sendTransaction2.apply(this, arguments);\n}\n/**\n * Function to initialize the biconomy object with DApp information.\n * It fetches the dapp's smart contract from biconomy database and initialize the decoders for each smart\n * contract which will be used to decode information during function calls.\n * @param dappId Id for dapp whos information is to be fetched\n * @param apiKey API key used to authenticate the request at biconomy server\n * @param _this object representing biconomy provider\n **/\n\nfunction _sendTransaction2() {\n  _sendTransaction2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee13(engine, account, api, data, cb, payload) {\n    var url, fetchOption;\n    return _regenerator[\"default\"].wrap(function _callee13$(_context13) {\n      while (1) {\n        switch (_context13.prev = _context13.next) {\n          case 0:\n            if (engine && account && api && data) {\n              url = api.url;\n              fetchOption = getFetchOptions(\"POST\", engine.apiKey);\n              fetchOption.body = JSON.stringify(data); //TODO\n\n              /*Before making API call to the core, Using other core APIs or sysinfi, sdk can check for customisation needs and pre flights like\n              1. Whitelisting of user addresses, conditional whitelisting\n              2. Gas price range validations\n              3. Dapp, User and Method limit breaches\n              etc\n              and make it fallback to default provider!\n              */\n\n              fetch(\"\".concat(baseURL).concat(url), fetchOption).then(function (response) {\n                return response.json();\n              }).then(function (result) {\n                _logMessage(result);\n                if (!result.txHash && result.flag != BICONOMY_RESPONSE_CODES.ACTION_COMPLETE && result.flag != BICONOMY_RESPONSE_CODES.SUCCESS) {\n                  // check if conditions not met error code\n                  if (result.code == BICONOMY_RESPONSE_CODES.CONDITIONS_NOT_SATISFIED) {\n                    if (engine.strictMode) {\n                      var _error17 = formatMessage(RESPONSE_CODES.CONDITIONS_NOT_SATISFIED, \"Conditions not met for given webhook attributes\");\n                      return cb(_error17);\n                    } else {\n                      _logMessage(\"Strict mode is off so falling back to default provider for handling transaction\");\n                      try {\n                        return callDefaultProvider(engine, payload, cb, \"Conditions not met for given webhook attributes\");\n                      } catch (error) {\n                        return cb(error);\n                      }\n                    }\n                  } //Any error from relayer infra\n                  //TODO\n                  //Involve fallback here with callDefaultProvider\n\n                  var error = {};\n                  error.code = result.flag || result.code;\n                  if (result.flag == BICONOMY_RESPONSE_CODES.USER_CONTRACT_NOT_FOUND) {\n                    error.code = RESPONSE_CODES.USER_CONTRACT_NOT_FOUND;\n                  }\n                  error.message = result.log || result.message;\n                  if (cb) cb(error);\n                } else {\n                  //TODO\n                  //Include listerner that will itself check for resubmitted hash api and serve over a socket?\n                  if (cb) cb(null, result.txHash);\n                }\n              })[\"catch\"](function (error) {\n                _logMessage(error);\n                if (cb) cb(error);\n              });\n            } else {\n              _logMessage(\"Invalid arguments, provider: \".concat(engine, \" account: \").concat(account, \" api: \").concat(api, \" data: \").concat(data));\n              if (cb) cb(\"Invalid arguments, provider: \".concat(engine, \" account: \").concat(account, \" api: \").concat(api, \" data: \").concat(data), null);\n            }\n          case 1:\n          case \"end\":\n            return _context13.stop();\n        }\n      }\n    }, _callee13);\n  }));\n  return _sendTransaction2.apply(this, arguments);\n}\nfunction _init(_x28, _x29) {\n  return _init2.apply(this, arguments);\n}\nfunction _init2() {\n  _init2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee15(apiKey, engine) {\n    var getDappAPI;\n    return _regenerator[\"default\"].wrap(function _callee15$(_context15) {\n      while (1) {\n        switch (_context15.prev = _context15.next) {\n          case 0:\n            _context15.prev = 0;\n            _context15.next = 3;\n            return engine.ethersProvider.getSigner();\n          case 3:\n            engine.signer = _context15.sent;\n            // Check current network id and dapp network id registered on dashboard\n            getDappAPI = \"\".concat(baseURL, \"/api/\").concat(config.version, \"/dapp\");\n            fetch(getDappAPI, getFetchOptions(\"GET\", apiKey)).then(function (response) {\n              return response.json();\n            }).then( /*#__PURE__*/function () {\n              var _ref9 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee14(dappResponse) {\n                var dappNetworkId, dappId, getNetworkIdOption, providerNetworkId;\n                return _regenerator[\"default\"].wrap(function _callee14$(_context14) {\n                  while (1) {\n                    switch (_context14.prev = _context14.next) {\n                      case 0:\n                        _logMessage(dappResponse);\n                        if (!(dappResponse && dappResponse.dapp)) {\n                          _context14.next = 21;\n                          break;\n                        }\n                        dappNetworkId = dappResponse.dapp.networkId;\n                        dappId = dappResponse.dapp._id;\n                        _logMessage(\"Network id corresponding to dapp id \".concat(dappId, \" is \").concat(dappNetworkId));\n                        getNetworkIdOption = {\n                          jsonrpc: JSON_RPC_VERSION,\n                          id: \"102\",\n                          method: \"eth_chainId\",\n                          params: []\n                        };\n                        if (!isEthersProvider(engine.originalProvider)) {\n                          _context14.next = 18;\n                          break;\n                        }\n                        _context14.next = 9;\n                        return engine.originalProvider.send(\"eth_chainId\", []);\n                      case 9:\n                        providerNetworkId = _context14.sent;\n                        if (!providerNetworkId) {\n                          _context14.next = 15;\n                          break;\n                        }\n                        providerNetworkId = parseInt(providerNetworkId.toString());\n                        onNetworkId(engine, {\n                          providerNetworkId: providerNetworkId,\n                          dappNetworkId: dappNetworkId,\n                          apiKey: apiKey,\n                          dappId: dappId\n                        });\n                        _context14.next = 16;\n                        break;\n                      case 15:\n                        return _context14.abrupt(\"return\", eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.NETWORK_ID_NOT_FOUND, \"Could not get network version\"), \"Could not get network version\"));\n                      case 16:\n                        _context14.next = 19;\n                        break;\n                      case 18:\n                        engine.originalProvider.send(getNetworkIdOption, function (error, networkResponse) {\n                          if (error || networkResponse && networkResponse.error) {\n                            return eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.NETWORK_ID_NOT_FOUND, \"Could not get network version\"), error || networkResponse.error);\n                          } else {\n                            var _providerNetworkId = parseInt(networkResponse.result.toString());\n                            onNetworkId(engine, {\n                              providerNetworkId: _providerNetworkId,\n                              dappNetworkId: dappNetworkId,\n                              apiKey: apiKey,\n                              dappId: dappId\n                            });\n                          }\n                        });\n                      case 19:\n                        _context14.next = 22;\n                        break;\n                      case 21:\n                        if (dappResponse.log) {\n                          eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, dappResponse.log));\n                        } else {\n                          eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.DAPP_NOT_FOUND, \"No Dapp Registered with apikey \".concat(apiKey)));\n                        }\n                      case 22:\n                      case \"end\":\n                        return _context14.stop();\n                    }\n                  }\n                }, _callee14);\n              }));\n              return function (_x36) {\n                return _ref9.apply(this, arguments);\n              };\n            }())[\"catch\"](function (error) {\n              eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Error while initializing Biconomy\"), error);\n            });\n            _context15.next = 11;\n            break;\n          case 8:\n            _context15.prev = 8;\n            _context15.t0 = _context15[\"catch\"](0);\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Error while initializing Biconomy\"), _context15.t0);\n          case 11:\n          case \"end\":\n            return _context15.stop();\n        }\n      }\n    }, _callee15, null, [[0, 8]]);\n  }));\n  return _init2.apply(this, arguments);\n}\nfunction isEthersProvider(provider) {\n  return ethers.providers.Provider.isProvider(provider);\n}\nfunction onNetworkId(_x30, _x31) {\n  return _onNetworkId.apply(this, arguments);\n}\nfunction _onNetworkId() {\n  _onNetworkId = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee16(engine, _ref6) {\n    var providerNetworkId, dappNetworkId, apiKey, dappId;\n    return _regenerator[\"default\"].wrap(function _callee16$(_context16) {\n      while (1) {\n        switch (_context16.prev = _context16.next) {\n          case 0:\n            providerNetworkId = _ref6.providerNetworkId, dappNetworkId = _ref6.dappNetworkId, apiKey = _ref6.apiKey, dappId = _ref6.dappId;\n            engine.networkId = providerNetworkId;\n            _logMessage(\"Current provider network id: \".concat(providerNetworkId));\n            if (!(providerNetworkId != dappNetworkId)) {\n              _context16.next = 7;\n              break;\n            }\n            return _context16.abrupt(\"return\", eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.NETWORK_ID_MISMATCH, \"Current networkId \".concat(providerNetworkId, \" is different from dapp network id registered on mexa dashboard \").concat(dappNetworkId))));\n          case 7:\n            domainData.chainId = providerNetworkId;\n            daiDomainData.chainId = providerNetworkId;\n            fetch(\"\".concat(baseURL, \"/api/\").concat(config.version2, \"/meta-tx/systemInfo?networkId=\").concat(providerNetworkId)).then(function (response) {\n              return response.json();\n            }).then(function (systemInfo) {\n              if (systemInfo) {\n                domainType = systemInfo.domainType;\n                forwarderDomainType = systemInfo.forwarderDomainType;\n                metaInfoType = systemInfo.metaInfoType;\n                relayerPaymentType = systemInfo.relayerPaymentType;\n                metaTransactionType = systemInfo.metaTransactionType;\n                loginDomainType = systemInfo.loginDomainType;\n                loginMessageType = systemInfo.loginMessageType;\n                loginDomainData = systemInfo.loginDomainData;\n                forwardRequestType = systemInfo.forwardRequestType;\n                forwarderDomainData = systemInfo.forwarderDomainData;\n                forwarderDomainDetails = systemInfo.forwarderDomainDetails;\n                trustedForwarderOverhead = systemInfo.overHeadEIP712Sign;\n                daiPermitOverhead = systemInfo.overHeadDaiPermit;\n                eip2612PermitOverhead = systemInfo.overHeadEIP2612Permit;\n                engine.forwarderAddress = systemInfo.biconomyForwarderAddress;\n                engine.forwarderAddresses = systemInfo.biconomyForwarderAddresses;\n                engine.erc20ForwarderAddress = systemInfo.erc20ForwarderAddress;\n                engine.transferHandlerAddress = systemInfo.transferHandlerAddress;\n                engine.daiTokenAddress = systemInfo.daiTokenAddress;\n                engine.usdtTokenAddress = systemInfo.usdtTokenAddress;\n                engine.usdcTokenAddress = systemInfo.usdcTokenAddress;\n                engine.TRUSTED_FORWARDER = systemInfo.trustedForwarderMetaTransaction;\n                engine.ERC20_FORWARDER = systemInfo.erc20ForwarderMetaTransaction;\n                engine.DEFAULT = systemInfo.defaultMetaTransaction;\n                engine.EIP712_SIGN = systemInfo.eip712Sign;\n                engine.PERSONAL_SIGN = systemInfo.personalSign;\n                engine.tokenGasPriceV1SupportedNetworks = systemInfo.tokenGasPriceV1SupportedNetworks;\n                engine.walletFactoryAddress = systemInfo.walletFactoryAddress;\n                engine.baseWalletAddress = systemInfo.baseWalletAddress;\n                engine.entryPointAddress = systemInfo.entryPointAddress;\n                engine.handlerAddress = systemInfo.handlerAddress;\n                daiDomainData.verifyingContract = engine.daiTokenAddress;\n                if (systemInfo.relayHubAddress) {\n                  domainData.verifyingContract = systemInfo.relayHubAddress;\n                }\n              } else {\n                return eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.INVALID_DATA, \"Could not get signature types from server. Contact Biconomy Team\"));\n              } // check if Valid trusted forwarder address is present from system info\n\n              if (engine.forwarderAddress && engine.forwarderAddress != \"\") {\n                //let supportedForwarders = engine.forwarderAddresses;\n                // prevent initialising it here as system info could return an array of forwarder addresses\n                biconomyForwarder = new ethers.Contract(\n                //pick up first forwarder address from the array by default then attach to an address accordingly\n                engine.forwarderAddress, biconomyForwarderAbi, engine.ethersProvider);\n              } // Get dapps smart contract data from biconomy servers\n\n              var getDAppInfoAPI = \"\".concat(baseURL, \"/api/\").concat(config.version, \"/smart-contract\");\n              fetch(getDAppInfoAPI, getFetchOptions(\"GET\", apiKey)).then(function (response) {\n                return response.json();\n              }).then(function (result) {\n                if (!result && result.flag != 143) {\n                  return eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.SMART_CONTRACT_NOT_FOUND, \"Error getting smart contract for dappId \".concat(dappId)));\n                }\n                var smartContractList = result.smartContracts;\n                if (smartContractList && smartContractList.length > 0) {\n                  smartContractList.forEach(function (contract) {\n                    var contractInterface = new ethers.utils.Interface(JSON.parse(contract.abi));\n                    if (contract.type === config.SCW) {\n                      smartContractMetaTransactionMap[config.SCW] = contract.metaTransactionType;\n                      interfaceMap[config.SCW] = contractInterface;\n                      smartContractMap[config.SCW] = contract.abi;\n                    } else {\n                      smartContractMetaTransactionMap[contract.address.toLowerCase()] = contract.metaTransactionType;\n                      interfaceMap[contract.address.toLowerCase()] = contractInterface;\n                      smartContractMap[contract.address.toLowerCase()] = contract.abi;\n                    }\n                  });\n                  _logMessage(smartContractMetaTransactionMap);\n                  _checkUserLogin(engine, dappId);\n                } else {\n                  if (engine.strictMode) {\n                    engine.status = STATUS.NO_DATA;\n                    eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.SMART_CONTRACT_NOT_FOUND, \"No smart contract registered for dappId \".concat(dappId, \" on Mexa Dashboard\")));\n                  } else {\n                    _checkUserLogin(engine, dappId);\n                  }\n                }\n              })[\"catch\"](function (error) {\n                eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Error while initializing Biconomy\"), error);\n              });\n            });\n          case 10:\n          case \"end\":\n            return _context16.stop();\n        }\n      }\n    }, _callee16);\n  }));\n  return _onNetworkId.apply(this, arguments);\n}\nfunction _checkUserLogin(_x32, _x33) {\n  return _checkUserLogin2.apply(this, arguments);\n}\nfunction _checkUserLogin2() {\n  _checkUserLogin2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee17(engine, dappId) {\n    return _regenerator[\"default\"].wrap(function _callee17$(_context17) {\n      while (1) {\n        switch (_context17.prev = _context17.next) {\n          case 0:\n            eventEmitter.emit(EVENTS.SMART_CONTRACT_DATA_READY, dappId, engine);\n          case 1:\n          case \"end\":\n            return _context17.stop();\n        }\n      }\n    }, _callee17);\n  }));\n  return _checkUserLogin2.apply(this, arguments);\n}\nBiconomy.prototype.isReady = function () {\n  return this.status === STATUS.BICONOMY_READY;\n};\nBiconomy.prototype.getUserAccount = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6() {\n  return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return _getUserAccount(this);\n        case 2:\n          return _context6.abrupt(\"return\", _context6.sent);\n        case 3:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _callee6, this);\n}));\nfunction getFetchOptions(method, apiKey) {\n  return {\n    method: method,\n    headers: {\n      \"x-api-key\": apiKey,\n      \"Content-Type\": \"application/json;charset=utf-8\"\n    }\n  };\n}\nfunction formatMessage(code, message) {\n  return {\n    code: code,\n    message: message\n  };\n}\n/**\n * Single method to be used for logging purpose.\n *\n * @param {string} message Message to be logged\n */\n\nfunction _logMessage(message) {\n  if (config && config.logsEnabled && console.log) {\n    console.log(message);\n  }\n}\nmodule.exports = Biconomy;","map":{"version":3,"names":["_interopRequireDefault","require","_regenerator","_typeof2","_toConsumableArray2","_asyncToGenerator2","Promise","ethers","txDecoder","abi","_require","toJSONRPCPayload","_require2","eip2771BaseAbi","_require3","config","RESPONSE_CODES","EVENTS","BICONOMY_RESPONSE_CODES","STATUS","DEFAULT_PAYLOAD_ID","baseURL","JSON_RPC_VERSION","NATIVE_META_TX_URL","nativeMetaTxUrl","PermitClient","ERC20ForwarderClient","BiconomyWalletClient","_require4","buildForwardTxRequest","getDomainSeperator","_require5","erc20ForwarderAbi","oracleAggregatorAbi","feeManagerAbi","biconomyForwarderAbi","transferHandlerAbi","fetch","interfaceMap","smartContractMap","smartContractMetaTransactionMap","smartContractTrustedForwarderMap","biconomyForwarder","events","eventEmitter","EventEmitter","trustedForwarderOverhead","daiPermitOverhead","eip2612PermitOverhead","domainType","forwarderDomainType","metaInfoType","relayerPaymentType","metaTransactionType","forwardRequestType","domainData","name","eip712DomainName","version","eip712SigVersion","verifyingContract","eip712VerifyingContract","daiDomainData","daiDomainName","daiVersion","forwarderDomainData","forwarderDomainDetails","loginDomainType","loginMessageType","loginDomainData","Biconomy","provider","options","_validate","isBiconomy","status","INIT","apiKey","isLogin","dappAPIMap","strictMode","providerId","readViaContract","READY","BICONOMY_READY","LOGIN_CONFIRMATION","ERROR","BICONOMY_ERROR","pendingLoginTransactions","jsonRPC","messageId","originalProvider","isEthersProviderPresent","canSignMessages","debug","logsEnabled","walletProvider","isEthersProvider","Error","providers","Web3Provider","ethersProvider","_init","proto","Object","getPrototypeOf","keys","getOwnPropertyNames","i","length","key","self","send","payload","cb","_this","id","jsonrpc","method","params","resolve","reject","handleSendTransaction","error","result","response","_createJsonRpcResponse","sendSignedTransaction","request","args","_logMessage","_ref","mark","_callee","jsonRPCPaylod","localResult","wrap","_callee$","_context","prev","next","sent","t0","err","stop","_x","_x2","apply","arguments","sendAsync","prototype","getSignerByAddress","userAddress","getEthersProvider","signer","getSigner","connectUnchecked","getAddress","_callee2","_callee2$","_context2","abrupt","getForwardRequestAndMessageToSign","rawTransaction","tokenAddress","customBatchId","customDomainName","customDomainVersion","engine","_ref3","_callee3","decodedTx","to","methodInfo","methodName","token","api","metaTxApproach","contractAddr","_error","parsedTransaction","account","gasLimit","gasLimitNum","contractABI","contract","_contract$estimateGas","_error2","cost","forwarderToUse","buildTxResponse","_error3","domainDataToUse","eip712DataToSign","hashToSign","dataToSign","_error4","_callee3$","_context3","decodeTx","data","value","toLowerCase","decodeMethod","formatMessage","DASHBOARD_DATA_MISMATCH","concat","daiTokenAddress","undefined","SCW","contractAddress","API_NOT_FOUND","utils","parseTransaction","from","parseInt","Contract","JSON","parse","estimateGas","signature","BigNumber","toString","add","toNumber","ERROR_RESPONSE","end","TRUSTED_FORWARDER","findTheRightForwarder","attach","ERC20_FORWARDER","erc20ForwarderClient","buildTx","txGas","INVALID_OPERATION","types","EIP712Domain","ERC20ForwardRequest","domain","primaryType","message","soliditySHA3","tokenGasPrice","batchId","batchNonce","deadline","keccak256","eip712Format","personalSignatureFormat","BICONOMY_NOT_INITIALIZED","_x3","_x4","onEvent","type","callback","on","EVENT_NOT_SUPPORTED","isHexString","_x5","_x6","_x7","_sendSignedTransaction","_callee7","signatureType","_error5","paramArray","_error6","forwardedData","_contract$estimateGas2","domainSeparator","_data","_data2","relayerPayment","_data3","_error7","_error8","_error9","_error10","_callee7$","_context7","forwardRequest","domainName","domainVersion","callDefaultProvider","t1","url","DEFAULT","push","EIP712_SIGN","apiId","_sendTransaction","DEFAULT_RELAYER_PAYMENT_TOKEN_ADDRESS","amount","DEFAULT_RELAYER_PAYMENT_AMOUNT","rawTx","hexValue","nonceBatchId","NONCE_BATCH_ID","expiry","EXPIRY","baseGas","BASE_GAS","INVALID_PAYLOAD","stringify","emit","_x8","_x9","_x10","_handleSendTransaction","_callee8","webHookAttributes","signTypedDataType","_error11","_error12","signatureFromPayload","_contract$estimateGas3","_error13","forwarderToAttach","signatureEIP712","signaturePersonal","_data4","_error14","_error15","_error16","_callee8$","_context8","code","WRONG_ABI","gas","toHexString","Number","SMART_CONTRACT_NOT_FOUND","getSignatureEIP712","getSignaturePersonal","t2","_x11","_x12","_x13","_x14","_callDefaultProvider","_callee9","errorMessage","targetProvider","responseFromProvider","_callee9$","_context9","getTargetProvider","_getEIP712ForwardMessageToSign","forwarder","_getPersonalForwardMessageToSign","getSignatureParameters","r","slice","s","v","includes","_x15","_x16","_findTheRightForwarder","_callee10","supportedForwarders","isTrustedForwarder","_callee10$","_context10","forwarderAddresses","forwarderAddress","trustedForwarder","promise","_ref4","_callee4","_getSignatureParamete","newSignature","_callee4$","_context4","res","oldSignature","_getSignatureParamete2","_r","_s","_v","_newSignature","_x17","_x18","_x19","_x20","_getSignaturePersonal","_callee12","req","providerWithSigner","_callee12$","_context12","_ref8","_callee11","_getSignatureParamete3","_callee11$","_context11","signMessage","arrayify","_x34","_x35","SMART_CONTRACT_DATA_READY","dappId","getAPIInfoAPI","getFetchOptions","then","json","listApis","apiList","DAPP_API_DATA_READY","HELPER_CLENTS_READY","_ref5","_callee5","biconomyAttributes","signerOrProvider","isSignerWithAccounts","erc20ForwarderAddress","transferHandlerAddress","erc20Forwarder","oracleAggregatorAddress","feeManagerAddress","oracleAggregator","feeManager","requiredDomainData","transferHandler","tokenGasPriceV1SupportedNetworks","_callee5$","_context5","signType","PERSONAL_SIGN","walletFactoryAddress","biconomyWalletClient","biconomyProvider","baseWalletAddress","entryPointAddress","handlerAddress","networkId","permitClient","forwarderClientOptions","_x21","_getUserAccount","_x22","_x23","_x24","_x25","_x26","_x27","_sendTransaction2","_callee13","fetchOption","_callee13$","_context13","body","txHash","flag","ACTION_COMPLETE","SUCCESS","CONDITIONS_NOT_SATISFIED","_error17","USER_CONTRACT_NOT_FOUND","log","_x28","_x29","_init2","_callee15","getDappAPI","_callee15$","_context15","_ref9","_callee14","dappResponse","dappNetworkId","getNetworkIdOption","providerNetworkId","_callee14$","_context14","dapp","_id","onNetworkId","NETWORK_ID_NOT_FOUND","networkResponse","_providerNetworkId","DAPP_NOT_FOUND","_x36","Provider","isProvider","_x30","_x31","_onNetworkId","_callee16","_ref6","_callee16$","_context16","NETWORK_ID_MISMATCH","chainId","version2","systemInfo","overHeadEIP712Sign","overHeadDaiPermit","overHeadEIP2612Permit","biconomyForwarderAddress","biconomyForwarderAddresses","usdtTokenAddress","usdcTokenAddress","trustedForwarderMetaTransaction","erc20ForwarderMetaTransaction","defaultMetaTransaction","eip712Sign","personalSign","relayHubAddress","INVALID_DATA","getDAppInfoAPI","smartContractList","smartContracts","forEach","contractInterface","Interface","address","_checkUserLogin","NO_DATA","_x32","_x33","_checkUserLogin2","_callee17","_callee17$","_context17","isReady","getUserAccount","_callee6","_callee6$","_context6","headers","console","module","exports"],"sources":["/home/hayden/workplace/dapp-demo/node_modules/@biconomy/mexa/common-js/Biconomy.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar Promise = require(\"promise\");\n\nvar ethers = require(\"ethers\");\n\nvar txDecoder = require(\"ethereum-tx-decoder\");\n\nvar abi = require(\"ethereumjs-abi\");\n\nvar _require = require(\"./util\"),\n    toJSONRPCPayload = _require.toJSONRPCPayload;\n\nvar _require2 = require(\"./abis\"),\n    eip2771BaseAbi = _require2.eip2771BaseAbi;\n\nvar _require3 = require(\"./config\"),\n    config = _require3.config,\n    RESPONSE_CODES = _require3.RESPONSE_CODES,\n    EVENTS = _require3.EVENTS,\n    BICONOMY_RESPONSE_CODES = _require3.BICONOMY_RESPONSE_CODES,\n    STATUS = _require3.STATUS;\n\nvar DEFAULT_PAYLOAD_ID = \"99999999\";\nvar baseURL = config.baseURL;\nvar JSON_RPC_VERSION = config.JSON_RPC_VERSION;\nvar NATIVE_META_TX_URL = config.nativeMetaTxUrl;\n\nvar PermitClient = require(\"./PermitClient\");\n\nvar ERC20ForwarderClient = require(\"./ERC20ForwarderClient\");\n\nvar BiconomyWalletClient = require(\"./BiconomyWalletClient\");\n\nvar _require4 = require(\"./biconomyforwarder\"),\n    buildForwardTxRequest = _require4.buildForwardTxRequest,\n    getDomainSeperator = _require4.getDomainSeperator;\n\nvar _require5 = require(\"./abis\"),\n    erc20ForwarderAbi = _require5.erc20ForwarderAbi,\n    oracleAggregatorAbi = _require5.oracleAggregatorAbi,\n    feeManagerAbi = _require5.feeManagerAbi,\n    biconomyForwarderAbi = _require5.biconomyForwarderAbi,\n    transferHandlerAbi = _require5.transferHandlerAbi;\n\nvar fetch = require(\"cross-fetch\");\n\nvar interfaceMap = {},\n    smartContractMap = {},\n    smartContractMetaTransactionMap = {},\n    smartContractTrustedForwarderMap = {};\nvar biconomyForwarder;\n\nvar events = require(\"events\");\n\nvar eventEmitter = new events.EventEmitter();\nvar trustedForwarderOverhead;\nvar daiPermitOverhead;\nvar eip2612PermitOverhead;\nvar domainType, forwarderDomainType, metaInfoType, relayerPaymentType, metaTransactionType, forwardRequestType; //domaindata would be sourced from forwarder -> domain details mapping\n\nvar domainData = {\n  name: config.eip712DomainName,\n  version: config.eip712SigVersion,\n  verifyingContract: config.eip712VerifyingContract\n};\nvar daiDomainData = {\n  name: config.daiDomainName,\n  version: config.daiVersion\n};\nvar forwarderDomainData, forwarderDomainDetails; // EIP712 format data for login\n\nvar loginDomainType, loginMessageType, loginDomainData;\n\nfunction Biconomy(provider, options) {\n  _validate(options);\n\n  this.isBiconomy = true;\n  this.status = STATUS.INIT;\n  this.options = options;\n  this.apiKey = options.apiKey;\n  this.isLogin = false;\n  this.dappAPIMap = {};\n  this.strictMode = options.strictMode || false;\n  this.providerId = options.providerId || 0;\n  this.readViaContract = options.readViaContract || false;\n  this.READY = STATUS.BICONOMY_READY;\n  this.LOGIN_CONFIRMATION = EVENTS.LOGIN_CONFIRMATION;\n  this.ERROR = EVENTS.BICONOMY_ERROR;\n  this.pendingLoginTransactions = {};\n  this.jsonRPC = {\n    messageId: 0\n  };\n  this.originalProvider = provider;\n  this.isEthersProviderPresent = false;\n  this.canSignMessages = false;\n\n  if (options.debug) {\n    config.logsEnabled = true;\n  }\n\n  if (options.walletProvider) {\n    if (isEthersProvider(options.walletProvider)) {\n      throw new Error(\"Wallet Provider in options can't be an ethers provider. Please pass the provider you get from your wallet directly.\");\n    }\n\n    this.walletProvider = new ethers.providers.Web3Provider(options.walletProvider);\n  }\n\n  if (provider) {\n    if (isEthersProvider(provider)) {\n      this.ethersProvider = provider;\n      this.isEthersProviderPresent = true;\n    } else {\n      this.ethersProvider = new ethers.providers.Web3Provider(provider);\n    }\n\n    _init(this.apiKey, this);\n\n    var proto = Object.getPrototypeOf(provider);\n    var keys = Object.getOwnPropertyNames(proto);\n\n    for (var i = 0; i < keys.length; i++) {\n      this[keys[i]] = provider[keys[i]];\n    }\n\n    for (var key in provider) {\n      if (!this[key]) {\n        this[key] = provider[key];\n      }\n    }\n\n    var self = this;\n\n    this.send = function (payload, cb) {\n      var _this = this;\n\n      if (typeof payload === \"string\") {\n        // Ethers provider is being used to call methods, so payload is actually method, and cb is params\n        payload = {\n          id: 1,\n          jsonrpc: \"2.0\",\n          method: payload,\n          params: cb\n        };\n      }\n\n      if (payload.method == \"eth_sendTransaction\") {\n        return new Promise(function (resolve, reject) {\n          handleSendTransaction(_this, payload, function (error, result) {\n            var response = _this._createJsonRpcResponse(payload, error, result);\n\n            if (cb && !self.isEthersProviderPresent) {\n              cb(error, response);\n            }\n\n            if (response.error) {\n              reject(response.error);\n            } else {\n              resolve(response.result);\n            }\n          });\n        });\n      } else if (payload.method == \"eth_sendRawTransaction\") {\n        return new Promise(function (resolve, reject) {\n          sendSignedTransaction(_this, payload, function (error, result) {\n            var response = _this._createJsonRpcResponse(payload, error, result);\n\n            if (cb && !self.isEthersProviderPresent) {\n              cb(error, response);\n            }\n\n            if (response.error) {\n              reject(response.error);\n            } else {\n              resolve(response.result);\n            }\n          });\n        });\n      } else {\n        if (self.isEthersProviderPresent) {\n          return self.originalProvider.send(payload.method, payload.params);\n        } else {\n          self.originalProvider.send(payload, cb);\n        }\n      }\n    };\n\n    this.request = function (args, cb) {\n      var payload = {\n        method: args.method,\n        params: args.params\n      };\n\n      if (payload.method == \"eth_sendTransaction\") {\n        return new Promise(function (resolve, reject) {\n          handleSendTransaction(self, payload, function (error, result) {\n            if (error) {\n              return reject(error);\n            }\n\n            if (result.result) {\n              resolve(result.result);\n\n              _logMessage(result.result);\n            } else {\n              resolve(result);\n\n              _logMessage(result);\n            }\n\n            if (cb) {\n              cb(error, result);\n            }\n          });\n        });\n      } else if (payload.method == \"eth_sendRawTransaction\") {\n        return new Promise(function (resolve, reject) {\n          sendSignedTransaction(self, payload, function (error, result) {\n            if (error) {\n              return reject(error);\n            }\n\n            if (result.result) {\n              resolve(result.result);\n\n              _logMessage(result.result);\n            } else {\n              resolve(result);\n\n              _logMessage(result);\n            }\n\n            if (cb) {\n              cb(error, result);\n            }\n          });\n        });\n      } else {\n        if (self.originalProvider.request) {\n          return self.originalProvider.request(args, cb);\n        } else if (self.originalProvider.send) {\n          return new Promise( /*#__PURE__*/function () {\n            var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(resolve, reject) {\n              var jsonRPCPaylod, localResult;\n              return _regenerator[\"default\"].wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      jsonRPCPaylod = toJSONRPCPayload(self, payload.method, payload.params);\n\n                      if (!self.isEthersProviderPresent) {\n                        _context.next = 14;\n                        break;\n                      }\n\n                      _context.prev = 2;\n                      _context.next = 5;\n                      return self.originalProvider.send(jsonRPCPaylod.method, jsonRPCPaylod.params);\n\n                    case 5:\n                      localResult = _context.sent;\n                      resolve(localResult);\n                      _context.next = 12;\n                      break;\n\n                    case 9:\n                      _context.prev = 9;\n                      _context.t0 = _context[\"catch\"](2);\n                      reject(_context.t0);\n\n                    case 12:\n                      _context.next = 15;\n                      break;\n\n                    case 14:\n                      self.originalProvider.send(jsonRPCPaylod, function (err, response) {\n                        if (err) {\n                          return reject(err);\n                        }\n\n                        if (response.result) {\n                          resolve(response.result);\n                        } else {\n                          resolve(response);\n                        }\n                      });\n\n                    case 15:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee, null, [[2, 9]]);\n            }));\n\n            return function (_x, _x2) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n        } else {\n          return Promise.reject(\"Invalid provider object passed to Biconomy as it doesn't support request or send method\");\n        }\n      }\n    };\n\n    this.sendAsync = this.send;\n  } else {\n    throw new Error(\"Please pass a provider to Biconomy.\");\n  }\n}\n\nBiconomy.prototype.getSignerByAddress = function (userAddress) {\n  var provider = this.getEthersProvider();\n  var signer = provider.getSigner();\n  signer = signer.connectUnchecked();\n  signer.getAddress = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", userAddress);\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return signer;\n};\n\nBiconomy.prototype.getEthersProvider = function () {\n  return new ethers.providers.Web3Provider(this);\n}; //TODO\n//Allow to provide custom txGas\n\n\nBiconomy.prototype.getForwardRequestAndMessageToSign = function (rawTransaction, tokenAddress, customBatchId, customDomainName, customDomainVersion, cb) {\n  try {\n    var engine = this;\n    return new Promise( /*#__PURE__*/function () {\n      var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(resolve, reject) {\n        var decodedTx, to, methodInfo, error, methodName, token, api, metaTxApproach, contractAddr, _error, parsedTransaction, account, gasLimit, gasLimitNum, contractABI, contract, _contract$estimateGas, _error2, request, cost, forwarderToUse, buildTxResponse, _error3, domainDataToUse, eip712DataToSign, hashToSign, dataToSign, _error4;\n\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!rawTransaction) {\n                  _context3.next = 80;\n                  break;\n                }\n\n                decodedTx = txDecoder.decodeTx(rawTransaction);\n\n                if (!(decodedTx.to && decodedTx.data && decodedTx.value)) {\n                  _context3.next = 77;\n                  break;\n                }\n\n                to = decodedTx.to.toLowerCase();\n                methodInfo = decodeMethod(to, decodedTx.data);\n\n                if (methodInfo) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                error = formatMessage(RESPONSE_CODES.DASHBOARD_DATA_MISMATCH, \"Smart Contract address registered on dashboard is different than what is sent(\".concat(decodedTx.to, \") in current transaction\"));\n                if (cb) cb(error);\n                return _context3.abrupt(\"return\", reject(error));\n\n              case 9:\n                methodName = methodInfo.name; //token address needs to be passed otherwise fees will be charged in DAI by default, given DAI permit is given\n\n                token = tokenAddress ? tokenAddress : engine.daiTokenAddress;\n\n                _logMessage(tokenAddress);\n\n                api = engine.dappAPIMap[to] ? engine.dappAPIMap[to][methodName] : undefined;\n\n                if (!api) {\n                  api = engine.dappAPIMap[config.SCW] ? engine.dappAPIMap[config.SCW][methodName] : undefined;\n                  metaTxApproach = smartContractMetaTransactionMap[config.SCW];\n                } else {\n                  contractAddr = api.contractAddress.toLowerCase();\n                  metaTxApproach = smartContractMetaTransactionMap[contractAddr];\n                }\n\n                if (api) {\n                  _context3.next = 19;\n                  break;\n                }\n\n                _logMessage(\"API not found for method \".concat(methodName));\n\n                _error = formatMessage(RESPONSE_CODES.API_NOT_FOUND, \"No API found on dashboard for called method \".concat(methodName));\n                if (cb) cb(_error);\n                return _context3.abrupt(\"return\", reject(_error));\n\n              case 19:\n                _logMessage(\"API found\");\n\n                parsedTransaction = ethers.utils.parseTransaction(rawTransaction);\n                account = parsedTransaction.from;\n\n                _logMessage(\"Signer is \".concat(account));\n\n                gasLimit = decodedTx.gasLimit;\n\n                if (!(!gasLimit || parseInt(gasLimit) == 0)) {\n                  _context3.next = 41;\n                  break;\n                }\n\n                contractABI = smartContractMap[to];\n\n                if (!contractABI) {\n                  _context3.next = 39;\n                  break;\n                }\n\n                contract = new ethers.Contract(to, JSON.parse(contractABI), engine.ethersProvider);\n                _context3.prev = 28;\n                _context3.next = 31;\n                return (_contract$estimateGas = contract.estimateGas)[methodInfo.signature].apply(_contract$estimateGas, (0, _toConsumableArray2[\"default\"])(methodInfo.args).concat([{\n                  from: account\n                }]));\n\n              case 31:\n                gasLimit = _context3.sent;\n                _context3.next = 37;\n                break;\n\n              case 34:\n                _context3.prev = 34;\n                _context3.t0 = _context3[\"catch\"](28);\n                return _context3.abrupt(\"return\", reject(_context3.t0));\n\n              case 37:\n                // Do not send this value in API call. only meant for txGas\n                gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).add(ethers.BigNumber.from(5000)).toNumber();\n\n                _logMessage(\"Gas limit number \".concat(gasLimitNum));\n\n              case 39:\n                _context3.next = 42;\n                break;\n\n              case 41:\n                gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).toNumber();\n\n              case 42:\n                if (account) {\n                  _context3.next = 45;\n                  break;\n                }\n\n                _error2 = formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Not able to get user account from signed transaction\");\n                return _context3.abrupt(\"return\", end(_error2));\n\n              case 45:\n                if (!(metaTxApproach == engine.TRUSTED_FORWARDER)) {\n                  _context3.next = 54;\n                  break;\n                }\n\n                _context3.next = 48;\n                return findTheRightForwarder(engine, to);\n\n              case 48:\n                forwarderToUse = _context3.sent;\n                _context3.next = 51;\n                return buildForwardTxRequest(account, to, gasLimitNum, decodedTx.data, biconomyForwarder.attach(forwarderToUse), customBatchId);\n\n              case 51:\n                request = _context3.sent.request;\n                _context3.next = 64;\n                break;\n\n              case 54:\n                if (!(metaTxApproach == engine.ERC20_FORWARDER)) {\n                  _context3.next = 61;\n                  break;\n                }\n\n                _context3.next = 57;\n                return engine.erc20ForwarderClient.buildTx({\n                  userAddress: account,\n                  to: to,\n                  txGas: gasLimitNum,\n                  data: decodedTx.data,\n                  token: token\n                });\n\n              case 57:\n                buildTxResponse = _context3.sent;\n\n                if (buildTxResponse) {\n                  request = buildTxResponse.request;\n                  cost = buildTxResponse.cost;\n                } else {\n                  reject(formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Unable to build forwarder request\"));\n                }\n\n                _context3.next = 64;\n                break;\n\n              case 61:\n                _error3 = formatMessage(RESPONSE_CODES.INVALID_OPERATION, \"Smart contract is not registered in the dashboard for this meta transaction approach. Kindly use biconomy.getUserMessageToSign\");\n                if (cb) cb(_error3);\n                return _context3.abrupt(\"return\", reject(_error3));\n\n              case 64:\n                _logMessage(\"Forward Request is: \");\n\n                _logMessage(request); // Update the verifyingContract field of domain data based on the current request\n\n\n                forwarderDomainData.verifyingContract = forwarderToUse;\n                domainDataToUse = forwarderDomainDetails[forwarderToUse];\n\n                if (customDomainName) {\n                  domainDataToUse.name = customDomainName.toString();\n                }\n\n                if (customDomainVersion) {\n                  domainDataToUse.version = customDomainVersion.toString();\n                }\n\n                eip712DataToSign = {\n                  types: {\n                    EIP712Domain: forwarderDomainType,\n                    ERC20ForwardRequest: forwardRequestType\n                  },\n                  domain: domainDataToUse,\n                  primaryType: \"ERC20ForwardRequest\",\n                  message: request\n                };\n                hashToSign = abi.soliditySHA3([\"address\", \"address\", \"address\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"bytes32\"], [request.from, request.to, request.token, request.txGas, request.tokenGasPrice, request.batchId, request.batchNonce, request.deadline, ethers.utils.keccak256(request.data)]);\n                dataToSign = {\n                  eip712Format: eip712DataToSign,\n                  personalSignatureFormat: hashToSign,\n                  request: request,\n                  cost: cost\n                };\n                if (cb) cb(null, dataToSign);\n                return _context3.abrupt(\"return\", resolve(dataToSign));\n\n              case 77:\n                _error4 = formatMessage(RESPONSE_CODES.BICONOMY_NOT_INITIALIZED, \"Decoders not initialized properly in mexa sdk. Make sure your have smart contracts registered on Mexa Dashboard\");\n                if (cb) cb(_error4);\n                return _context3.abrupt(\"return\", reject(_error4));\n\n              case 80:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[28, 34]]);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  } catch (error) {\n    return end(error);\n  }\n};\n/**\n * Method used to listen to events emitted from the SDK\n */\n\n\nBiconomy.prototype.onEvent = function (type, callback) {\n  if (type == this.READY || type == this.ERROR || type == this.LOGIN_CONFIRMATION) {\n    eventEmitter.on(type, callback);\n    return this;\n  } else {\n    throw formatMessage(RESPONSE_CODES.EVENT_NOT_SUPPORTED, \"\".concat(type, \" event is not supported.\"));\n  }\n};\n/**\n * Create a JSON RPC response from the given error and result parameter.\n **/\n\n\nBiconomy.prototype._createJsonRpcResponse = function (payload, error, result) {\n  var response = {};\n  response.id = payload.id;\n  response.jsonrpc = JSON_RPC_VERSION;\n\n  if ((!error || error == null) && !result) {\n    response.error = \"Unexpected error has occurred. Please contact Biconomy Team\";\n    return response;\n  }\n\n  if (error) {\n    response.error = error;\n  } else if (result && result.error) {\n    response.error = result.error;\n  } else if (ethers.utils.isHexString(result)) {\n    response.result = result;\n  } else {\n    response = result;\n  }\n\n  return response;\n};\n\nfunction decodeMethod(to, data) {\n  if (to && data && interfaceMap[to]) {\n    return interfaceMap[to].parseTransaction({\n      data: data\n    });\n  }\n\n  return;\n}\n/**\n * Method used to handle transaction initiated using web3.eth.sendSignedTransaction method\n * It extracts rawTransaction from payload and decode it to get required information like from, to,\n * data, gasLimit to create the payload for biconomy meta transaction API.\n * In case of Native meta transaction, payload just contains rawTransaction\n * In case of contract based meta transaction, payload contains rawTransaction and signature wrapped\n * in a json object.\n *\n * @param {Object} engine Reference to this SDK instance\n * @param {Object} payload Payload data\n * @param {Function} end Callback function with error as first argument\n */\n\n\nfunction sendSignedTransaction(_x5, _x6, _x7) {\n  return _sendSignedTransaction.apply(this, arguments);\n}\n/**\n * Function decodes the parameter in payload and gets the user signature using eth_signTypedData_v4\n * method and send the request to biconomy for processing and call the callback method 'end'\n * with transaction hash.\n *\n * This is an internal function that is called while intercepting eth_sendTransaction RPC method call.\n **/\n\n\nfunction _sendSignedTransaction() {\n  _sendSignedTransaction = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(engine, payload, end) {\n    var data, rawTransaction, signature, request, signatureType, customDomainName, customDomainVersion, decodedTx, to, methodInfo, error, methodName, api, metaTxApproach, contractAddr, _error5, paramArray, parsedTransaction, account, _error6, forwardedData, gasLimitNum, gasLimit, contractABI, _contract$estimateGas2, contract, forwarderToUse, domainDataToUse, domainSeparator, _data, _data2, relayerPayment, _data3, _error7, _error8, _error9, _error10;\n\n    return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            if (!(payload && payload.params[0])) {\n              _context7.next = 114;\n              break;\n            }\n\n            data = payload.params[0];\n\n            // user would need to pass token address as well!\n            // OR they could pass the symbol and engine will provide the address for you..\n            // default is DAI\n            if (typeof data == \"string\") {\n              // Here user send the rawTransaction in the payload directly. Probably the case of native meta transaction\n              // Handle this scenario differently?\n              rawTransaction = data;\n            } else if ((0, _typeof2[\"default\"])(data) == \"object\") {\n              // Here user wrapped raw Transaction in json object along with signature\n              signature = data.signature;\n              rawTransaction = data.rawTransaction;\n              signatureType = data.signatureType;\n              request = data.forwardRequest;\n              customDomainName = data.domainName;\n              customDomainVersion = data.domainVersion;\n            }\n\n            if (!rawTransaction) {\n              _context7.next = 109;\n              break;\n            }\n\n            decodedTx = txDecoder.decodeTx(rawTransaction);\n\n            if (!(decodedTx.to && decodedTx.data && decodedTx.value)) {\n              _context7.next = 104;\n              break;\n            }\n\n            to = decodedTx.to.toLowerCase();\n            methodInfo = decodeMethod(to, decodedTx.data);\n\n            if (methodInfo) {\n              _context7.next = 25;\n              break;\n            }\n\n            methodInfo = decodeMethod(config.SCW, decodedTx.data);\n\n            if (methodInfo) {\n              _context7.next = 25;\n              break;\n            }\n\n            if (!engine.strictMode) {\n              _context7.next = 16;\n              break;\n            }\n\n            error = formatMessage(RESPONSE_CODES.DASHBOARD_DATA_MISMATCH, \"No smart contract wallet or smart contract registered on dashboard with address (\".concat(decodedTx.to, \")\"));\n            return _context7.abrupt(\"return\", end(error));\n\n          case 16:\n            _logMessage(\"Strict mode is off so falling back to default provider for handling transaction\");\n\n            if ((0, _typeof2[\"default\"])(data) == \"object\" && data.rawTransaction) {\n              payload.params = [data.rawTransaction];\n            }\n\n            _context7.prev = 18;\n            return _context7.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"No smart contract wallet or smart contract registered on dashboard with address (\".concat(decodedTx.to, \")\")));\n\n          case 22:\n            _context7.prev = 22;\n            _context7.t0 = _context7[\"catch\"](18);\n            return _context7.abrupt(\"return\", end(_context7.t0));\n\n          case 25:\n            methodName = methodInfo.name;\n            api = engine.dappAPIMap[to] ? engine.dappAPIMap[to][methodName] : undefined;\n\n            if (!api) {\n              api = engine.dappAPIMap[config.SCW] ? engine.dappAPIMap[config.SCW][methodName] : undefined;\n              metaTxApproach = smartContractMetaTransactionMap[config.SCW];\n            } else {\n              contractAddr = api.contractAddress.toLowerCase();\n              metaTxApproach = smartContractMetaTransactionMap[contractAddr];\n            }\n\n            if (api) {\n              _context7.next = 45;\n              break;\n            }\n\n            _logMessage(\"API not found for method \".concat(methodName));\n\n            _logMessage(\"Strict mode \".concat(engine.strictMode));\n\n            if (!engine.strictMode) {\n              _context7.next = 36;\n              break;\n            }\n\n            _error5 = formatMessage(RESPONSE_CODES.API_NOT_FOUND, \"Biconomy strict mode is on. No registered API found for method \".concat(methodName, \". Please register API from developer dashboard.\"));\n            return _context7.abrupt(\"return\", end(_error5, null));\n\n          case 36:\n            _logMessage(\"Falling back to default provider as strict mode is false in biconomy\");\n\n            if ((0, _typeof2[\"default\"])(data) == \"object\" && data.rawTransaction) {\n              payload.params = [data.rawTransaction];\n            }\n\n            _context7.prev = 38;\n            return _context7.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"Current provider can not sign transactions. Make sure to register method \".concat(methodName, \" on Biconomy Dashboard\")));\n\n          case 42:\n            _context7.prev = 42;\n            _context7.t1 = _context7[\"catch\"](38);\n            return _context7.abrupt(\"return\", end(_context7.t1));\n\n          case 45:\n            _logMessage(\"API found\");\n\n            paramArray = [];\n            parsedTransaction = ethers.utils.parseTransaction(rawTransaction);\n            account = parsedTransaction ? parsedTransaction.from : undefined;\n\n            _logMessage(\"signer is \".concat(account));\n\n            if (account) {\n              _context7.next = 53;\n              break;\n            }\n\n            _error6 = formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Not able to get user account from signed transaction\");\n            return _context7.abrupt(\"return\", end(_error6));\n\n          case 53:\n            gasLimit = decodedTx.gasLimit;\n\n            if (!(api.url == NATIVE_META_TX_URL)) {\n              _context7.next = 101;\n              break;\n            }\n\n            if (!(metaTxApproach != engine.DEFAULT)) {\n              _context7.next = 90;\n              break;\n            }\n\n            // forwardedData = payload.params[0].data;\n            forwardedData = decodedTx.data;\n\n            if (!(!gasLimit || parseInt(gasLimit) == 0)) {\n              _context7.next = 68;\n              break;\n            }\n\n            contractABI = smartContractMap[to];\n\n            if (!contractABI) {\n              _context7.next = 66;\n              break;\n            }\n\n            contract = new ethers.Contract(to, JSON.parse(contractABI), engine.ethersProvider);\n            _context7.next = 63;\n            return (_contract$estimateGas2 = contract.estimateGas)[methodInfo.signature].apply(_contract$estimateGas2, (0, _toConsumableArray2[\"default\"])(methodInfo.args).concat([{\n              from: account\n            }]));\n\n          case 63:\n            gasLimit = _context7.sent;\n            // do not send this value in API call. only meant for txGas\n            gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).add(ethers.BigNumber.from(5000)).toNumber();\n\n            _logMessage(\"gas limit number\" + gasLimitNum);\n\n          case 66:\n            _context7.next = 69;\n            break;\n\n          case 68:\n            gasLimitNum = ethers.BigNumber.from(gasLimit.toString()).toNumber();\n\n          case 69:\n            _logMessage(request);\n\n            paramArray.push(request);\n            _context7.next = 73;\n            return findTheRightForwarder(engine, to);\n\n          case 73:\n            forwarderToUse = _context7.sent;\n            //Update the verifyingContract in domain data\n            forwarderDomainData.verifyingContract = forwarderToUse;\n            domainDataToUse = forwarderDomainDetails[forwarderToUse];\n\n            if (customDomainName) {\n              domainDataToUse.name = customDomainName.toString();\n            }\n\n            if (customDomainVersion) {\n              domainDataToUse.version = customDomainVersion.toString();\n            } // Update the verifyingContract field of domain data based on the current request\n\n\n            if (signatureType && signatureType == engine.EIP712_SIGN) {\n              domainSeparator = getDomainSeperator(domainDataToUse);\n\n              _logMessage(domainSeparator);\n\n              paramArray.push(domainSeparator);\n            }\n\n            paramArray.push(signature);\n            _data = {};\n            _data.from = account;\n            _data.apiId = api.id;\n            _data.params = paramArray;\n            _data.to = to;\n\n            if (signatureType && signatureType == engine.EIP712_SIGN) {\n              _data.signatureType = engine.EIP712_SIGN;\n            }\n\n            _context7.next = 88;\n            return _sendTransaction(engine, account, api, _data, end, payload);\n\n          case 88:\n            _context7.next = 99;\n            break;\n\n          case 90:\n            paramArray.push.apply(paramArray, (0, _toConsumableArray2[\"default\"])(methodInfo.args));\n            _data2 = {};\n            _data2.from = account;\n            _data2.apiId = api.id;\n            _data2.params = paramArray;\n            _data2.gasLimit = decodedTx.gasLimit.toString(); //verify\n\n            _data2.to = decodedTx.to.toLowerCase();\n            _context7.next = 99;\n            return _sendTransaction(engine, account, api, _data2, end, payload);\n\n          case 99:\n            _context7.next = 102;\n            break;\n\n          case 101:\n            if (signature) {\n              relayerPayment = {};\n              relayerPayment.token = config.DEFAULT_RELAYER_PAYMENT_TOKEN_ADDRESS;\n              relayerPayment.amount = config.DEFAULT_RELAYER_PAYMENT_AMOUNT;\n              _data3 = {};\n              _data3.rawTx = rawTransaction;\n              _data3.signature = signature;\n              _data3.to = to;\n              _data3.from = account;\n              _data3.apiId = api.id;\n              _data3.data = decodedTx.data;\n              _data3.value = ethers.utils.hexValue(decodedTx.value);\n              _data3.gasLimit = decodedTx.gasLimit.toString();\n              _data3.nonceBatchId = config.NONCE_BATCH_ID;\n              _data3.expiry = config.EXPIRY;\n              _data3.baseGas = config.BASE_GAS;\n              _data3.relayerPayment = {\n                token: relayerPayment.token,\n                amount: relayerPayment.amount\n              };\n\n              _sendTransaction(engine, account, api, _data3, end, payload);\n            } else {\n              _error7 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload.params[0]), \". message and signature are required in param object\"));\n              eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error7);\n              end(_error7);\n            }\n\n          case 102:\n            _context7.next = 107;\n            break;\n\n          case 104:\n            _error8 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Not able to deode the data in rawTransaction using ethereum-tx-decoder. Please check the data sent.\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error8);\n            end(_error8);\n\n          case 107:\n            _context7.next = 112;\n            break;\n\n          case 109:\n            _error9 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload.params[0]), \".rawTransaction is required in param object\"));\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error9);\n            end(_error9);\n\n          case 112:\n            _context7.next = 117;\n            break;\n\n          case 114:\n            _error10 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload.params[0]), \". Non empty Array expected in params key\"));\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error10);\n            end(_error10);\n\n          case 117:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, null, [[18, 22], [38, 42]]);\n  }));\n  return _sendSignedTransaction.apply(this, arguments);\n}\n\nfunction handleSendTransaction(_x8, _x9, _x10) {\n  return _handleSendTransaction.apply(this, arguments);\n}\n\nfunction _handleSendTransaction() {\n  _handleSendTransaction = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee8(engine, payload, end) {\n    var to, methodInfo, error, methodName, api, metaTxApproach, customBatchId, webHookAttributes, customDomainName, customDomainVersion, signTypedDataType, contractAddr, gasLimit, txGas, signatureType, _error11, account, paramArray, _error12, forwardedData, gasLimitNum, signatureFromPayload, contractABI, _contract$estimateGas3, contract, _error13, forwarderToAttach, request, domainDataToUse, domainSeparator, signatureEIP712, signaturePersonal, data, _data4, _error14, _error15, _error16;\n\n    return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            _context8.prev = 0;\n\n            _logMessage(\"Handle transaction with payload\");\n\n            _logMessage(payload);\n\n            if (!(payload.params && payload.params[0] && payload.params[0].to)) {\n              _context8.next = 171;\n              break;\n            }\n\n            to = payload.params[0].to.toLowerCase();\n\n            if (!(interfaceMap[to] || interfaceMap[config.SCW])) {\n              _context8.next = 155;\n              break;\n            }\n\n            methodInfo = decodeMethod(to, payload.params[0].data); // Check if the Smart Contract Wallet is registered on dashboard\n\n            if (!methodInfo) {\n              methodInfo = decodeMethod(config.SCW, payload.params[0].data);\n            }\n\n            if (methodInfo) {\n              _context8.next = 13;\n              break;\n            }\n\n            error = {};\n            error.code = RESPONSE_CODES.WRONG_ABI;\n            error.message = \"Can't decode method information from payload. Make sure you have uploaded correct ABI on Biconomy Dashboard\";\n            return _context8.abrupt(\"return\", end(error, null));\n\n          case 13:\n            methodName = methodInfo.name;\n            api = engine.dappAPIMap[to] ? engine.dappAPIMap[to][methodName] : undefined; // Information we get here is contractAddress, methodName, methodType, ApiId\n\n            if (!api) {\n              api = engine.dappAPIMap[config.SCW] ? engine.dappAPIMap[config.SCW][methodName] : undefined;\n              metaTxApproach = smartContractMetaTransactionMap[config.SCW];\n            } else {\n              contractAddr = api.contractAddress.toLowerCase();\n              metaTxApproach = smartContractMetaTransactionMap[contractAddr];\n            } //Sanitise gas limit here. big number / hex / number -> hex\n\n\n            gasLimit = payload.params[0].gas || payload.params[0].gasLimit;\n\n            if (gasLimit) {\n              gasLimit = ethers.BigNumber.from(gasLimit.toString()).toHexString();\n            }\n\n            txGas = payload.params[0].txGas;\n            signatureType = payload.params[0].signatureType;\n\n            if (payload.params[0].batchId) {\n              customBatchId = Number(payload.params[0].batchId);\n            }\n\n            if (payload.params[0].webHookAttributes) {\n              webHookAttributes = payload.params[0].webHookAttributes;\n            }\n\n            if (payload.params[0].domainName) {\n              customDomainName = payload.params[0].domainName;\n            }\n\n            if (payload.params[0].domainVersion) {\n              customDomainVersion = payload.params[0].domainVersion;\n            }\n\n            if (payload.params[0].signTypedDataType) {\n              signTypedDataType = payload.params[0].signTypedDataType;\n            }\n\n            _logMessage(payload.params[0]);\n\n            _logMessage(api);\n\n            _logMessage(\"gas limit : \".concat(gasLimit));\n\n            if (txGas) {\n              _logMessage(\"tx gas supplied : \".concat(txGas));\n            }\n\n            if (api) {\n              _context8.next = 47;\n              break;\n            }\n\n            _logMessage(\"API not found for method \".concat(methodName));\n\n            _logMessage(\"Strict mode \".concat(engine.strictMode));\n\n            if (!engine.strictMode) {\n              _context8.next = 39;\n              break;\n            }\n\n            _error11 = {};\n            _error11.code = RESPONSE_CODES.API_NOT_FOUND;\n            _error11.message = \"Biconomy strict mode is on. No registered API found for method \".concat(methodName, \". Please register API from developer dashboard.\");\n            return _context8.abrupt(\"return\", end(_error11, null));\n\n          case 39:\n            _logMessage(\"Falling back to default provider as strict mode is false in biconomy\");\n\n            _context8.prev = 40;\n            return _context8.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"No registered API found for method \".concat(methodName, \". Please register API from developer dashboard.\")));\n\n          case 44:\n            _context8.prev = 44;\n            _context8.t0 = _context8[\"catch\"](40);\n            return _context8.abrupt(\"return\", end(_context8.t0));\n\n          case 47:\n            _logMessage(\"API found\");\n\n            _logMessage(\"Getting user account\");\n\n            account = payload.params[0].from;\n\n            if (account) {\n              _context8.next = 52;\n              break;\n            }\n\n            return _context8.abrupt(\"return\", end(\"Not able to get user account\"));\n\n          case 52:\n            _logMessage(\"User account fetched\");\n\n            _logMessage(methodInfo.args);\n\n            paramArray = [];\n\n            if (!(metaTxApproach == engine.ERC20_FORWARDER)) {\n              _context8.next = 59;\n              break;\n            }\n\n            _error12 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"This operation is not allowed for contracts registered on dashboard as \\\"ERC20Forwarder\\\". Use ERC20Forwarder client instead!\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error12);\n            return _context8.abrupt(\"return\", end(_error12));\n\n          case 59:\n            if (!(api.url == NATIVE_META_TX_URL)) {\n              _context8.next = 150;\n              break;\n            }\n\n            if (!(metaTxApproach == engine.TRUSTED_FORWARDER)) {\n              _context8.next = 139;\n              break;\n            }\n\n            _logMessage(\"Smart contract is configured to use Trusted Forwarder as meta transaction type\");\n\n            forwardedData = payload.params[0].data;\n            signatureFromPayload = payload.params[0].signature; // Check if txGas is present, if not calculate gas limit for txGas\n\n            if (!(!txGas || parseInt(txGas) == 0)) {\n              _context8.next = 80;\n              break;\n            }\n\n            contractABI = smartContractMap[to];\n\n            if (!contractABI) {\n              _context8.next = 75;\n              break;\n            }\n\n            contract = new ethers.Contract(to, JSON.parse(contractABI), engine.ethersProvider);\n            _context8.next = 70;\n            return (_contract$estimateGas3 = contract.estimateGas)[methodInfo.signature].apply(_contract$estimateGas3, (0, _toConsumableArray2[\"default\"])(methodInfo.args).concat([{\n              from: account\n            }]));\n\n          case 70:\n            txGas = _context8.sent;\n            // do not send this value in API call. only meant for txGas\n            gasLimitNum = ethers.BigNumber.from(txGas.toString()).add(ethers.BigNumber.from(5000)).toNumber();\n\n            _logMessage(\"Gas limit (txGas) calculated for method \".concat(methodName, \" in SDK: \").concat(gasLimitNum));\n\n            _context8.next = 78;\n            break;\n\n          case 75:\n            _error13 = formatMessage(RESPONSE_CODES.SMART_CONTRACT_NOT_FOUND, \"Smart contract ABI not found!\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error13);\n            end(_error13);\n\n          case 78:\n            _context8.next = 83;\n            break;\n\n          case 80:\n            _logMessage(\"txGas supplied for this Trusted Forwarder call is \".concat(Number(txGas)));\n\n            gasLimitNum = ethers.BigNumber.from(txGas.toString()).toNumber();\n\n            _logMessage(\"gas limit number for txGas \" + gasLimitNum);\n\n          case 83:\n            _context8.next = 85;\n            return findTheRightForwarder(engine, to);\n\n          case 85:\n            forwarderToAttach = _context8.sent;\n            _context8.next = 88;\n            return buildForwardTxRequest(account, to, parseInt(gasLimitNum), //txGas\n            forwardedData, biconomyForwarder.attach(forwarderToAttach), customBatchId);\n\n          case 88:\n            request = _context8.sent.request;\n\n            _logMessage(request);\n\n            paramArray.push(request);\n            forwarderDomainData.verifyingContract = forwarderToAttach;\n            domainDataToUse = forwarderDomainDetails[forwarderToAttach];\n\n            if (customDomainName) {\n              domainDataToUse.name = customDomainName.toString();\n            }\n\n            if (customDomainVersion) {\n              domainDataToUse.version = customDomainVersion.toString();\n            }\n\n            if (!(signatureType && signatureType == engine.EIP712_SIGN)) {\n              _context8.next = 113;\n              break;\n            }\n\n            _logMessage(\"EIP712 signature flow\"); // Update the verifyingContract field of domain data based on the current request\n\n\n            domainSeparator = getDomainSeperator(domainDataToUse);\n\n            _logMessage(\"Domain separator to be used:\");\n\n            _logMessage(domainSeparator);\n\n            paramArray.push(domainSeparator);\n\n            if (!signatureFromPayload) {\n              _context8.next = 106;\n              break;\n            }\n\n            signatureEIP712 = signatureFromPayload;\n\n            _logMessage(\"EIP712 signature from payload is \".concat(signatureEIP712));\n\n            _context8.next = 110;\n            break;\n\n          case 106:\n            _context8.next = 108;\n            return getSignatureEIP712(engine, account, request, forwarderToAttach, domainDataToUse, signTypedDataType);\n\n          case 108:\n            signatureEIP712 = _context8.sent;\n\n            _logMessage(\"EIP712 signature is \".concat(signatureEIP712));\n\n          case 110:\n            paramArray.push(signatureEIP712);\n            _context8.next = 128;\n            break;\n\n          case 113:\n            _logMessage(\"Personal signature flow\");\n\n            if (!signatureFromPayload) {\n              _context8.next = 119;\n              break;\n            }\n\n            signaturePersonal = signatureFromPayload;\n\n            _logMessage(\"Personal signature from payload is \".concat(signaturePersonal));\n\n            _context8.next = 123;\n            break;\n\n          case 119:\n            _context8.next = 121;\n            return getSignaturePersonal(engine, request);\n\n          case 121:\n            signaturePersonal = _context8.sent;\n\n            _logMessage(\"Personal signature is \".concat(signaturePersonal));\n\n          case 123:\n            if (!signaturePersonal) {\n              _context8.next = 127;\n              break;\n            }\n\n            paramArray.push(signaturePersonal);\n            _context8.next = 128;\n            break;\n\n          case 127:\n            throw new Error(\"Could not get personal signature while processing transaction in Mexa SDK. Please check the providers you have passed to Biconomy\");\n\n          case 128:\n            data = {};\n            data.from = account;\n            data.apiId = api.id;\n            data.params = paramArray;\n            data.to = to; //gasLimit for entire transaction\n            //This will be calculated at the backend again\n\n            data.gasLimit = gasLimit;\n\n            if (signatureType && signatureType == engine.EIP712_SIGN) {\n              data.signatureType = engine.EIP712_SIGN;\n            }\n\n            _context8.next = 137;\n            return _sendTransaction(engine, account, api, data, end, payload);\n\n          case 137:\n            _context8.next = 148;\n            break;\n\n          case 139:\n            paramArray.push.apply(paramArray, (0, _toConsumableArray2[\"default\"])(methodInfo.args));\n            _data4 = {};\n            _data4.from = account;\n            _data4.apiId = api.id;\n            _data4.params = paramArray;\n            _data4.gasLimit = gasLimit;\n            _data4.to = to;\n            _data4.webHookAttributes = webHookAttributes;\n\n            _sendTransaction(engine, account, api, _data4, end, payload);\n\n          case 148:\n            _context8.next = 153;\n            break;\n\n          case 150:\n            _error14 = formatMessage(RESPONSE_CODES.INVALID_OPERATION, \"Biconomy smart contract wallets are not supported now. On dashboard, re-register your smart contract methods with \\\"native meta tx\\\" checkbox selected.\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error14);\n            return _context8.abrupt(\"return\", end(_error14));\n\n          case 153:\n            _context8.next = 169;\n            break;\n\n          case 155:\n            if (!engine.strictMode) {\n              _context8.next = 161;\n              break;\n            }\n\n            _error15 = formatMessage(RESPONSE_CODES.BICONOMY_NOT_INITIALIZED, \"Decoders not initialized properly in mexa sdk. Make sure your have smart contracts registered on Mexa Dashboard\");\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error15);\n            end(_error15);\n            _context8.next = 169;\n            break;\n\n          case 161:\n            _logMessage(\"Smart contract not found on dashbaord. Strict mode is off, so falling back to normal transaction mode\");\n\n            _context8.prev = 162;\n            return _context8.abrupt(\"return\", callDefaultProvider(engine, payload, end, \"Current provider can't send transactions and smart contract \".concat(to, \" not found on Biconomy Dashbaord\")));\n\n          case 166:\n            _context8.prev = 166;\n            _context8.t1 = _context8[\"catch\"](162);\n            return _context8.abrupt(\"return\", end(_context8.t1));\n\n          case 169:\n            _context8.next = 174;\n            break;\n\n          case 171:\n            _error16 = formatMessage(RESPONSE_CODES.INVALID_PAYLOAD, \"Invalid payload data \".concat(JSON.stringify(payload), \". Expecting params key to be an array with first element having a 'to' property\"));\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, _error16);\n            end(_error16);\n\n          case 174:\n            _context8.next = 179;\n            break;\n\n          case 176:\n            _context8.prev = 176;\n            _context8.t2 = _context8[\"catch\"](0);\n            return _context8.abrupt(\"return\", end(_context8.t2));\n\n          case 179:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8, null, [[0, 176], [40, 44], [162, 166]]);\n  }));\n  return _handleSendTransaction.apply(this, arguments);\n}\n\nfunction callDefaultProvider(_x11, _x12, _x13, _x14) {\n  return _callDefaultProvider.apply(this, arguments);\n}\n\nfunction _callDefaultProvider() {\n  _callDefaultProvider = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee9(engine, payload, callback, errorMessage) {\n    var targetProvider, responseFromProvider;\n    return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            _context9.prev = 0;\n            targetProvider = getTargetProvider(engine);\n\n            if (!targetProvider) {\n              _context9.next = 15;\n              break;\n            }\n\n            if (!isEthersProvider(targetProvider)) {\n              _context9.next = 12;\n              break;\n            }\n\n            _context9.next = 6;\n            return targetProvider.send(payload.method, payload.params);\n\n          case 6:\n            responseFromProvider = _context9.sent;\n\n            _logMessage(\"Response from original provider\", responseFromProvider);\n\n            callback(null, responseFromProvider);\n            return _context9.abrupt(\"return\", responseFromProvider);\n\n          case 12:\n            return _context9.abrupt(\"return\", targetProvider.send(payload, callback));\n\n          case 13:\n            _context9.next = 17;\n            break;\n\n          case 15:\n            _logMessage(\"No provider present in Biconomy that can sign messages\");\n\n            throw new Error(errorMessage);\n\n          case 17:\n            _context9.next = 24;\n            break;\n\n          case 19:\n            _context9.prev = 19;\n            _context9.t0 = _context9[\"catch\"](0);\n\n            _logMessage(\"Unexpected error occured when calling default provider\");\n\n            _logMessage(_context9.t0);\n\n            return _context9.abrupt(\"return\", callback(_context9.t0));\n\n          case 24:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9, null, [[0, 19]]);\n  }));\n  return _callDefaultProvider.apply(this, arguments);\n}\n\nfunction _getEIP712ForwardMessageToSign(request, forwarder, domainData) {\n  // Update the verifyingContract field of domain data based on the current request\n  if (!forwarderDomainType || !forwardRequestType || !forwarderDomainData || !forwarder) {\n    throw new Error(\"Biconomy is not properly initialized\");\n  }\n\n  if (!forwarderDomainDetails || Object.keys(forwarderDomainDetails).length === 0) {\n    throw new Error(\"Biconomy is not properly initialized\");\n  } //Override domainData\n\n\n  var domainDataToUse = domainData; //Might update version as well\n\n  var dataToSign = JSON.stringify({\n    types: {\n      EIP712Domain: forwarderDomainType,\n      ERC20ForwardRequest: forwardRequestType\n    },\n    domain: domainDataToUse,\n    primaryType: \"ERC20ForwardRequest\",\n    message: request\n  });\n  return dataToSign;\n}\n\nfunction _getPersonalForwardMessageToSign(request) {\n  return abi.soliditySHA3([\"address\", \"address\", \"address\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"uint256\", \"bytes32\"], [request.from, request.to, request.token, request.txGas, request.tokenGasPrice, request.batchId, request.batchNonce, request.deadline, ethers.utils.keccak256(request.data)]);\n}\n\nfunction getTargetProvider(engine) {\n  var provider;\n\n  if (engine) {\n    provider = engine.originalProvider;\n\n    if (!engine.canSignMessages) {\n      if (!engine.walletProvider) {\n        //comment this out and just log\n        //throw new Error(`Please pass a provider connected to a wallet that can sign messages in Biconomy options.`);\n        _logMessage(\"Please pass a provider connected to a wallet that can sign messages in Biconomy options\");\n      } else {\n        provider = engine.walletProvider;\n      }\n    }\n  }\n\n  return provider;\n}\n\nfunction getSignatureParameters(signature) {\n  if (!ethers.utils.isHexString(signature)) {\n    throw new Error('Given value \"'.concat(signature, '\" is not a valid hex string.'));\n  }\n\n  var r = signature.slice(0, 66);\n  var s = \"0x\".concat(signature.slice(66, 130));\n  var v = \"0x\".concat(signature.slice(130, 132));\n  v = ethers.BigNumber.from(v).toNumber();\n  if (![27, 28].includes(v)) v += 27;\n  return {\n    r: r,\n    s: s,\n    v: v\n  };\n}\n\nfunction findTheRightForwarder(_x15, _x16) {\n  return _findTheRightForwarder.apply(this, arguments);\n} //take parameter for chosen signature type V3 or V4\n\n\nfunction _findTheRightForwarder() {\n  _findTheRightForwarder = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee10(engine, to) {\n    var forwarderToUse, ethersProvider, contract, supportedForwarders, forwarder, i, isTrustedForwarder;\n    return _regenerator[\"default\"].wrap(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            if (!smartContractTrustedForwarderMap[to]) {\n              _context10.next = 4;\n              break;\n            }\n\n            forwarderToUse = smartContractTrustedForwarderMap[to];\n            _context10.next = 41;\n            break;\n\n          case 4:\n            if (engine.isEthersProviderPresent) {\n              ethersProvider = engine.originalProvider;\n            } else {\n              ethersProvider = new ethers.providers.Web3Provider(engine.originalProvider);\n            }\n\n            contract = new ethers.Contract(to, eip2771BaseAbi, ethersProvider);\n            supportedForwarders = engine.forwarderAddresses;\n            forwarderToUse = engine.forwarderAddress; //default forwarder\n            // Attempt to find out forwarder that 'to' contract trusts\n\n            _context10.prev = 8;\n            _context10.next = 11;\n            return contract.trustedForwarder();\n\n          case 11:\n            forwarder = _context10.sent;\n            _context10.next = 18;\n            break;\n\n          case 14:\n            _context10.prev = 14;\n            _context10.t0 = _context10[\"catch\"](8);\n\n            _logMessage(\"Could not find read method 'trustedForwarder' in the contract abi\");\n\n            _logMessage(_context10.t0);\n\n          case 18:\n            i = 0;\n\n          case 19:\n            if (!(i < supportedForwarders.length)) {\n              _context10.next = 40;\n              break;\n            }\n\n            if (!forwarder) {\n              _context10.next = 24;\n              break;\n            }\n\n            if (!(supportedForwarders[i].toString() == forwarder.toString())) {\n              _context10.next = 24;\n              break;\n            }\n\n            forwarderToUse = supportedForwarders[i];\n            return _context10.abrupt(\"break\", 40);\n\n          case 24:\n            _context10.prev = 24;\n            _context10.next = 27;\n            return contract.isTrustedForwarder(supportedForwarders[i]);\n\n          case 27:\n            isTrustedForwarder = _context10.sent;\n\n            if (!isTrustedForwarder) {\n              _context10.next = 31;\n              break;\n            }\n\n            forwarderToUse = supportedForwarders[i];\n            return _context10.abrupt(\"break\", 40);\n\n          case 31:\n            _context10.next = 37;\n            break;\n\n          case 33:\n            _context10.prev = 33;\n            _context10.t1 = _context10[\"catch\"](24);\n\n            _logMessage(\"Could not find read method 'isTrustedForwarder' in the contract abi\");\n\n            _logMessage(_context10.t1);\n\n          case 37:\n            i++;\n            _context10.next = 19;\n            break;\n\n          case 40:\n            smartContractTrustedForwarderMap[to] = forwarderToUse;\n\n          case 41:\n            return _context10.abrupt(\"return\", forwarderToUse);\n\n          case 42:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, _callee10, null, [[8, 14], [24, 33]]);\n  }));\n  return _findTheRightForwarder.apply(this, arguments);\n}\n\nfunction getSignatureEIP712(engine, account, request, forwarder, domainData, type) {\n  //default V4 now   \n  var signTypedDataType = \"eth_signTypedData_v4\";\n\n  if (type === \"v3\" || type === \"V3\") {\n    signTypedDataType = \"eth_signTypedData_v3\";\n  }\n\n  var dataToSign = _getEIP712ForwardMessageToSign(request, forwarder, domainData);\n\n  var targetProvider = getTargetProvider(engine);\n\n  if (!targetProvider) {\n    throw new Error(\"Unable to get provider information passed to Biconomy\");\n  }\n\n  var promise = new Promise( /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(resolve, reject) {\n      var signature, _getSignatureParamete, r, s, v, newSignature;\n\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!targetProvider) {\n                _context4.next = 21;\n                break;\n              }\n\n              if (!isEthersProvider(targetProvider)) {\n                _context4.next = 17;\n                break;\n              }\n\n              _context4.prev = 2;\n              _context4.next = 5;\n              return targetProvider.send(signTypedDataType, [account, dataToSign]);\n\n            case 5:\n              signature = _context4.sent;\n              _getSignatureParamete = getSignatureParameters(signature), r = _getSignatureParamete.r, s = _getSignatureParamete.s, v = _getSignatureParamete.v;\n              v = ethers.BigNumber.from(v).toHexString();\n              newSignature = r + s.slice(2) + v.slice(2);\n              resolve(newSignature);\n              _context4.next = 15;\n              break;\n\n            case 12:\n              _context4.prev = 12;\n              _context4.t0 = _context4[\"catch\"](2);\n              reject(_context4.t0);\n\n            case 15:\n              _context4.next = 19;\n              break;\n\n            case 17:\n              _context4.next = 19;\n              return targetProvider.send({\n                jsonrpc: \"2.0\",\n                id: 999999999999,\n                method: signTypedDataType,\n                params: [account, dataToSign]\n              }, function (error, res) {\n                if (error) {\n                  reject(error);\n                } else {\n                  var oldSignature = res.result;\n\n                  var _getSignatureParamete2 = getSignatureParameters(oldSignature),\n                      _r = _getSignatureParamete2.r,\n                      _s = _getSignatureParamete2.s,\n                      _v = _getSignatureParamete2.v;\n\n                  _v = ethers.BigNumber.from(_v).toHexString();\n\n                  var _newSignature = _r + _s.slice(2) + _v.slice(2);\n\n                  resolve(_newSignature);\n                }\n              });\n\n            case 19:\n              _context4.next = 22;\n              break;\n\n            case 21:\n              reject(\"Could not get signature from the provider passed to Biconomy. Check if you have passed a walletProvider in Biconomy Options.\");\n\n            case 22:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[2, 12]]);\n    }));\n\n    return function (_x17, _x18) {\n      return _ref4.apply(this, arguments);\n    };\n  }());\n  return promise;\n}\n\nfunction getSignaturePersonal(_x19, _x20) {\n  return _getSignaturePersonal.apply(this, arguments);\n} // On getting smart contract data get the API data also\n\n\nfunction _getSignaturePersonal() {\n  _getSignaturePersonal = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee12(engine, req) {\n    var hashToSign, signature, targetProvider, providerWithSigner, signer, promise;\n    return _regenerator[\"default\"].wrap(function _callee12$(_context12) {\n      while (1) {\n        switch (_context12.prev = _context12.next) {\n          case 0:\n            hashToSign = _getPersonalForwardMessageToSign(req);\n\n            if (!(!engine.signer && !engine.walletProvider)) {\n              _context12.next = 3;\n              break;\n            }\n\n            throw new Error(\"Can't sign messages with current provider. Did you forget to pass walletProvider in Biconomy options?\");\n\n          case 3:\n            targetProvider = getTargetProvider(engine);\n\n            if (targetProvider) {\n              _context12.next = 6;\n              break;\n            }\n\n            throw new Error(\"Unable to get provider information passed to Biconomy\");\n\n          case 6:\n            if (isEthersProvider(targetProvider)) {\n              providerWithSigner = targetProvider;\n            } else {\n              providerWithSigner = new ethers.providers.Web3Provider(targetProvider);\n            }\n\n            signer = providerWithSigner.getSigner();\n            promise = new Promise( /*#__PURE__*/function () {\n              var _ref8 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee11(resolve, reject) {\n                var _getSignatureParamete3, r, s, v, newSignature;\n\n                return _regenerator[\"default\"].wrap(function _callee11$(_context11) {\n                  while (1) {\n                    switch (_context11.prev = _context11.next) {\n                      case 0:\n                        _context11.prev = 0;\n                        _context11.next = 3;\n                        return signer.signMessage(ethers.utils.arrayify(hashToSign));\n\n                      case 3:\n                        signature = _context11.sent;\n                        _getSignatureParamete3 = getSignatureParameters(signature), r = _getSignatureParamete3.r, s = _getSignatureParamete3.s, v = _getSignatureParamete3.v;\n                        v = ethers.BigNumber.from(v).toHexString();\n                        newSignature = r + s.slice(2) + v.slice(2);\n                        resolve(newSignature);\n                        _context11.next = 13;\n                        break;\n\n                      case 10:\n                        _context11.prev = 10;\n                        _context11.t0 = _context11[\"catch\"](0);\n                        reject(_context11.t0);\n\n                      case 13:\n                      case \"end\":\n                        return _context11.stop();\n                    }\n                  }\n                }, _callee11, null, [[0, 10]]);\n              }));\n\n              return function (_x34, _x35) {\n                return _ref8.apply(this, arguments);\n              };\n            }());\n            return _context12.abrupt(\"return\", promise);\n\n          case 10:\n          case \"end\":\n            return _context12.stop();\n        }\n      }\n    }, _callee12);\n  }));\n  return _getSignaturePersonal.apply(this, arguments);\n}\n\neventEmitter.on(EVENTS.SMART_CONTRACT_DATA_READY, function (dappId, engine) {\n  // Get DApp API information from Database\n  var getAPIInfoAPI = \"\".concat(baseURL, \"/api/\").concat(config.version, \"/meta-api\");\n  fetch(getAPIInfoAPI, getFetchOptions(\"GET\", engine.apiKey)).then(function (response) {\n    return response.json();\n  }).then(function (response) {\n    if (response && response.listApis) {\n      var apiList = response.listApis;\n\n      for (var i = 0; i < apiList.length; i++) {\n        var contractAddress = apiList[i].contractAddress; // TODO: In case of SCW(Smart Contract Wallet) there'll be no contract address. Save SCW as key in that case.\n\n        if (contractAddress) {\n          if (!engine.dappAPIMap[contractAddress]) {\n            engine.dappAPIMap[contractAddress] = {};\n          }\n\n          engine.dappAPIMap[contractAddress][apiList[i].method] = apiList[i];\n        } else {\n          if (!engine.dappAPIMap[config.SCW]) {\n            engine.dappAPIMap[config.SCW] = {};\n          }\n\n          engine.dappAPIMap[config.SCW][apiList[i].method] = apiList[i];\n        }\n      }\n\n      eventEmitter.emit(EVENTS.DAPP_API_DATA_READY, engine);\n    }\n  })[\"catch\"](function (error) {\n    _logMessage(error);\n  });\n});\neventEmitter.on(EVENTS.HELPER_CLENTS_READY, /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(engine) {\n    var biconomyAttributes, targetProvider, ethersProvider, signer, signerOrProvider, isSignerWithAccounts, erc20ForwarderAddress, transferHandlerAddress, erc20Forwarder, oracleAggregatorAddress, feeManagerAddress, forwarderAddress, oracleAggregator, feeManager, forwarder, requiredDomainData, transferHandler, tokenGasPriceV1SupportedNetworks;\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            biconomyAttributes = {\n              apiKey: engine.apiKey,\n              dappAPIMap: engine.dappAPIMap,\n              interfaceMap: interfaceMap,\n              signType: {\n                EIP712_SIGN: engine.EIP712_SIGN,\n                PERSONAL_SIGN: engine.PERSONAL_SIGN\n              }\n            };\n            targetProvider = getTargetProvider(engine);\n            /*if(!targetProvider) {\n              throw new Error(`Unable to get provider information passed to Biconomy`);\n            }*/\n\n            if (engine.isEthersProviderPresent) {\n              ethersProvider = engine.originalProvider;\n            } else {\n              ethersProvider = new ethers.providers.Web3Provider(engine.originalProvider);\n            }\n\n            signer = ethersProvider.getSigner();\n            signerOrProvider = signer;\n            isSignerWithAccounts = true;\n            _context5.prev = 7;\n            _context5.next = 10;\n            return signer.getAddress();\n\n          case 10:\n            engine.canSignMessages = true;\n            _context5.next = 19;\n            break;\n\n          case 13:\n            _context5.prev = 13;\n            _context5.t0 = _context5[\"catch\"](7);\n\n            _logMessage(\"Given provider does not have accounts information\");\n\n            signerOrProvider = ethersProvider;\n            isSignerWithAccounts = false;\n            engine.canSignMessages = false;\n\n          case 19:\n            erc20ForwarderAddress = engine.options.erc20ForwarderAddress || engine.erc20ForwarderAddress;\n            transferHandlerAddress = engine.options.transferHandlerAddress || engine.transferHandlerAddress; // Has to be biconomy wrapped provider in order to make gasless calls!\n\n            if (engine.walletFactoryAddress) {\n              engine.biconomyWalletClient = new BiconomyWalletClient({\n                biconomyProvider: engine,\n                provider: ethersProvider,\n                targetProvider: targetProvider,\n                isSignerWithAccounts: isSignerWithAccounts,\n                biconomyAttributes: biconomyAttributes,\n                walletFactoryAddress: engine.walletFactoryAddress,\n                baseWalletAddress: engine.baseWalletAddress,\n                entryPointAddress: engine.entryPointAddress,\n                handlerAddress: engine.handlerAddress,\n                networkId: engine.networkId\n              });\n\n              _logMessage(engine.biconomyWalletClient);\n            }\n\n            if (!erc20ForwarderAddress) {\n              _context5.next = 45;\n              break;\n            }\n\n            erc20Forwarder = new ethers.Contract(erc20ForwarderAddress, erc20ForwarderAbi, signerOrProvider);\n            _context5.next = 26;\n            return erc20Forwarder.oracleAggregator();\n\n          case 26:\n            oracleAggregatorAddress = _context5.sent;\n            _context5.next = 29;\n            return erc20Forwarder.feeManager();\n\n          case 29:\n            feeManagerAddress = _context5.sent;\n            _context5.next = 32;\n            return erc20Forwarder.forwarder();\n\n          case 32:\n            forwarderAddress = _context5.sent;\n            oracleAggregator = new ethers.Contract(oracleAggregatorAddress, oracleAggregatorAbi, signerOrProvider);\n            feeManager = new ethers.Contract(feeManagerAddress, feeManagerAbi, signerOrProvider); //If ERC20 Forwarder Address exits then it would have configured Forwarder \n\n            forwarder = new ethers.Contract(forwarderAddress, biconomyForwarderAbi, signerOrProvider);\n            requiredDomainData = forwarderDomainDetails[forwarderAddress];\n            transferHandler = new ethers.Contract(transferHandlerAddress, transferHandlerAbi, signerOrProvider);\n            tokenGasPriceV1SupportedNetworks = engine.tokenGasPriceV1SupportedNetworks;\n            engine.permitClient = new PermitClient(engine, erc20ForwarderAddress, engine.daiTokenAddress); //TODO\n            //Review initialisation of ERC20 Forwarder as well!\n\n            engine.erc20ForwarderClient = new ERC20ForwarderClient({\n              forwarderClientOptions: biconomyAttributes,\n              networkId: engine.networkId,\n              provider: ethersProvider,\n              targetProvider: targetProvider,\n              forwarderDomainData: requiredDomainData,\n              forwarderDomainDetails: forwarderDomainDetails,\n              forwarderDomainType: forwarderDomainType,\n              erc20Forwarder: erc20Forwarder,\n              transferHandler: transferHandler,\n              forwarder: forwarder,\n              oracleAggregator: oracleAggregator,\n              feeManager: feeManager,\n              isSignerWithAccounts: isSignerWithAccounts,\n              tokenGasPriceV1SupportedNetworks: tokenGasPriceV1SupportedNetworks,\n              trustedForwarderOverhead: trustedForwarderOverhead,\n              daiPermitOverhead: daiPermitOverhead,\n              eip2612PermitOverhead: eip2612PermitOverhead\n            });\n\n            _logMessage(engine.permitClient);\n\n            _logMessage(engine.erc20ForwarderClient);\n\n            _context5.next = 46;\n            break;\n\n          case 45:\n            _logMessage(\"ERC20 Forwarder is not supported for this network\"); //Warning : you would not be able to use ERC20ForwarderClient and PermitClient \n\n\n          case 46:\n            engine.status = STATUS.BICONOMY_READY;\n            eventEmitter.emit(STATUS.BICONOMY_READY);\n            _context5.next = 53;\n            break;\n\n          case 50:\n            _context5.prev = 50;\n            _context5.t1 = _context5[\"catch\"](0);\n\n            _logMessage(_context5.t1);\n\n          case 53:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[0, 50], [7, 13]]);\n  }));\n\n  return function (_x21) {\n    return _ref5.apply(this, arguments);\n  };\n}());\neventEmitter.on(EVENTS.DAPP_API_DATA_READY, function (engine) {\n  eventEmitter.emit(EVENTS.HELPER_CLENTS_READY, engine);\n});\n/**\n * Get user account from current provider using eth_accounts method.\n **/\n\nfunction _getUserAccount(engine, payload, cb) {\n  if (engine) {\n    var id = DEFAULT_PAYLOAD_ID;\n\n    if (payload) {\n      id = payload.id;\n    }\n\n    if (cb) {\n      engine.originalProvider.send({\n        jsonrpc: JSON_RPC_VERSION,\n        id: id,\n        method: \"eth_accounts\",\n        params: []\n      }, function (error, response) {\n        cb(error, response);\n      });\n    } else {\n      return new Promise(function (resolve, reject) {\n        engine.originalProvider.send({\n          jsonrpc: JSON_RPC_VERSION,\n          id: id,\n          method: \"eth_accounts\",\n          params: []\n        }, function (error, res) {\n          if (error) {\n            reject(error);\n          } else if (!res.result) {\n            reject(\"Invalid response \".concat(res));\n          } else {\n            resolve(res.result[0]);\n          }\n        });\n      });\n    }\n  }\n}\n/**\n * Validate parameters passed to biconomy object. Dapp id and api key are mandatory.\n **/\n\n\nfunction _validate(options) {\n  if (!options) {\n    throw new Error(\"Options object needs to be passed to Biconomy Object with apiKey as mandatory key\");\n  }\n\n  if (!options.apiKey) {\n    throw new Error(\"apiKey is required in options object when creating Biconomy object\");\n  }\n}\n/**\n * Method to send the transaction to biconomy server and call the callback method\n * to pass the result of meta transaction to web3 function call.\n * @param engine Object representing biconomy provider engine\n * @param account User selected account on current wallet\n * @param api API object got from biconomy server\n * @param data Data to be sent to biconomy server having transaction data\n * @param cb Callback method to be called to pass result or send error\n **/\n\n\nfunction _sendTransaction(_x22, _x23, _x24, _x25, _x26, _x27) {\n  return _sendTransaction2.apply(this, arguments);\n}\n/**\n * Function to initialize the biconomy object with DApp information.\n * It fetches the dapp's smart contract from biconomy database and initialize the decoders for each smart\n * contract which will be used to decode information during function calls.\n * @param dappId Id for dapp whos information is to be fetched\n * @param apiKey API key used to authenticate the request at biconomy server\n * @param _this object representing biconomy provider\n **/\n\n\nfunction _sendTransaction2() {\n  _sendTransaction2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee13(engine, account, api, data, cb, payload) {\n    var url, fetchOption;\n    return _regenerator[\"default\"].wrap(function _callee13$(_context13) {\n      while (1) {\n        switch (_context13.prev = _context13.next) {\n          case 0:\n            if (engine && account && api && data) {\n              url = api.url;\n              fetchOption = getFetchOptions(\"POST\", engine.apiKey);\n              fetchOption.body = JSON.stringify(data); //TODO\n\n              /*Before making API call to the core, Using other core APIs or sysinfi, sdk can check for customisation needs and pre flights like\n              1. Whitelisting of user addresses, conditional whitelisting\n              2. Gas price range validations\n              3. Dapp, User and Method limit breaches\n              etc\n              and make it fallback to default provider!\n              */\n\n              fetch(\"\".concat(baseURL).concat(url), fetchOption).then(function (response) {\n                return response.json();\n              }).then(function (result) {\n                _logMessage(result);\n\n                if (!result.txHash && result.flag != BICONOMY_RESPONSE_CODES.ACTION_COMPLETE && result.flag != BICONOMY_RESPONSE_CODES.SUCCESS) {\n                  // check if conditions not met error code\n                  if (result.code == BICONOMY_RESPONSE_CODES.CONDITIONS_NOT_SATISFIED) {\n                    if (engine.strictMode) {\n                      var _error17 = formatMessage(RESPONSE_CODES.CONDITIONS_NOT_SATISFIED, \"Conditions not met for given webhook attributes\");\n\n                      return cb(_error17);\n                    } else {\n                      _logMessage(\"Strict mode is off so falling back to default provider for handling transaction\");\n\n                      try {\n                        return callDefaultProvider(engine, payload, cb, \"Conditions not met for given webhook attributes\");\n                      } catch (error) {\n                        return cb(error);\n                      }\n                    }\n                  } //Any error from relayer infra\n                  //TODO\n                  //Involve fallback here with callDefaultProvider\n\n\n                  var error = {};\n                  error.code = result.flag || result.code;\n\n                  if (result.flag == BICONOMY_RESPONSE_CODES.USER_CONTRACT_NOT_FOUND) {\n                    error.code = RESPONSE_CODES.USER_CONTRACT_NOT_FOUND;\n                  }\n\n                  error.message = result.log || result.message;\n                  if (cb) cb(error);\n                } else {\n                  //TODO\n                  //Include listerner that will itself check for resubmitted hash api and serve over a socket?\n                  if (cb) cb(null, result.txHash);\n                }\n              })[\"catch\"](function (error) {\n                _logMessage(error);\n\n                if (cb) cb(error);\n              });\n            } else {\n              _logMessage(\"Invalid arguments, provider: \".concat(engine, \" account: \").concat(account, \" api: \").concat(api, \" data: \").concat(data));\n\n              if (cb) cb(\"Invalid arguments, provider: \".concat(engine, \" account: \").concat(account, \" api: \").concat(api, \" data: \").concat(data), null);\n            }\n\n          case 1:\n          case \"end\":\n            return _context13.stop();\n        }\n      }\n    }, _callee13);\n  }));\n  return _sendTransaction2.apply(this, arguments);\n}\n\nfunction _init(_x28, _x29) {\n  return _init2.apply(this, arguments);\n}\n\nfunction _init2() {\n  _init2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee15(apiKey, engine) {\n    var getDappAPI;\n    return _regenerator[\"default\"].wrap(function _callee15$(_context15) {\n      while (1) {\n        switch (_context15.prev = _context15.next) {\n          case 0:\n            _context15.prev = 0;\n            _context15.next = 3;\n            return engine.ethersProvider.getSigner();\n\n          case 3:\n            engine.signer = _context15.sent;\n            // Check current network id and dapp network id registered on dashboard\n            getDappAPI = \"\".concat(baseURL, \"/api/\").concat(config.version, \"/dapp\");\n            fetch(getDappAPI, getFetchOptions(\"GET\", apiKey)).then(function (response) {\n              return response.json();\n            }).then( /*#__PURE__*/function () {\n              var _ref9 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee14(dappResponse) {\n                var dappNetworkId, dappId, getNetworkIdOption, providerNetworkId;\n                return _regenerator[\"default\"].wrap(function _callee14$(_context14) {\n                  while (1) {\n                    switch (_context14.prev = _context14.next) {\n                      case 0:\n                        _logMessage(dappResponse);\n\n                        if (!(dappResponse && dappResponse.dapp)) {\n                          _context14.next = 21;\n                          break;\n                        }\n\n                        dappNetworkId = dappResponse.dapp.networkId;\n                        dappId = dappResponse.dapp._id;\n\n                        _logMessage(\"Network id corresponding to dapp id \".concat(dappId, \" is \").concat(dappNetworkId));\n\n                        getNetworkIdOption = {\n                          jsonrpc: JSON_RPC_VERSION,\n                          id: \"102\",\n                          method: \"eth_chainId\",\n                          params: []\n                        };\n\n                        if (!isEthersProvider(engine.originalProvider)) {\n                          _context14.next = 18;\n                          break;\n                        }\n\n                        _context14.next = 9;\n                        return engine.originalProvider.send(\"eth_chainId\", []);\n\n                      case 9:\n                        providerNetworkId = _context14.sent;\n\n                        if (!providerNetworkId) {\n                          _context14.next = 15;\n                          break;\n                        }\n\n                        providerNetworkId = parseInt(providerNetworkId.toString());\n                        onNetworkId(engine, {\n                          providerNetworkId: providerNetworkId,\n                          dappNetworkId: dappNetworkId,\n                          apiKey: apiKey,\n                          dappId: dappId\n                        });\n                        _context14.next = 16;\n                        break;\n\n                      case 15:\n                        return _context14.abrupt(\"return\", eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.NETWORK_ID_NOT_FOUND, \"Could not get network version\"), \"Could not get network version\"));\n\n                      case 16:\n                        _context14.next = 19;\n                        break;\n\n                      case 18:\n                        engine.originalProvider.send(getNetworkIdOption, function (error, networkResponse) {\n                          if (error || networkResponse && networkResponse.error) {\n                            return eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.NETWORK_ID_NOT_FOUND, \"Could not get network version\"), error || networkResponse.error);\n                          } else {\n                            var _providerNetworkId = parseInt(networkResponse.result.toString());\n\n                            onNetworkId(engine, {\n                              providerNetworkId: _providerNetworkId,\n                              dappNetworkId: dappNetworkId,\n                              apiKey: apiKey,\n                              dappId: dappId\n                            });\n                          }\n                        });\n\n                      case 19:\n                        _context14.next = 22;\n                        break;\n\n                      case 21:\n                        if (dappResponse.log) {\n                          eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, dappResponse.log));\n                        } else {\n                          eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.DAPP_NOT_FOUND, \"No Dapp Registered with apikey \".concat(apiKey)));\n                        }\n\n                      case 22:\n                      case \"end\":\n                        return _context14.stop();\n                    }\n                  }\n                }, _callee14);\n              }));\n\n              return function (_x36) {\n                return _ref9.apply(this, arguments);\n              };\n            }())[\"catch\"](function (error) {\n              eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Error while initializing Biconomy\"), error);\n            });\n            _context15.next = 11;\n            break;\n\n          case 8:\n            _context15.prev = 8;\n            _context15.t0 = _context15[\"catch\"](0);\n            eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Error while initializing Biconomy\"), _context15.t0);\n\n          case 11:\n          case \"end\":\n            return _context15.stop();\n        }\n      }\n    }, _callee15, null, [[0, 8]]);\n  }));\n  return _init2.apply(this, arguments);\n}\n\nfunction isEthersProvider(provider) {\n  return ethers.providers.Provider.isProvider(provider);\n}\n\nfunction onNetworkId(_x30, _x31) {\n  return _onNetworkId.apply(this, arguments);\n}\n\nfunction _onNetworkId() {\n  _onNetworkId = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee16(engine, _ref6) {\n    var providerNetworkId, dappNetworkId, apiKey, dappId;\n    return _regenerator[\"default\"].wrap(function _callee16$(_context16) {\n      while (1) {\n        switch (_context16.prev = _context16.next) {\n          case 0:\n            providerNetworkId = _ref6.providerNetworkId, dappNetworkId = _ref6.dappNetworkId, apiKey = _ref6.apiKey, dappId = _ref6.dappId;\n            engine.networkId = providerNetworkId;\n\n            _logMessage(\"Current provider network id: \".concat(providerNetworkId));\n\n            if (!(providerNetworkId != dappNetworkId)) {\n              _context16.next = 7;\n              break;\n            }\n\n            return _context16.abrupt(\"return\", eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.NETWORK_ID_MISMATCH, \"Current networkId \".concat(providerNetworkId, \" is different from dapp network id registered on mexa dashboard \").concat(dappNetworkId))));\n\n          case 7:\n            domainData.chainId = providerNetworkId;\n            daiDomainData.chainId = providerNetworkId;\n            fetch(\"\".concat(baseURL, \"/api/\").concat(config.version2, \"/meta-tx/systemInfo?networkId=\").concat(providerNetworkId)).then(function (response) {\n              return response.json();\n            }).then(function (systemInfo) {\n              if (systemInfo) {\n                domainType = systemInfo.domainType;\n                forwarderDomainType = systemInfo.forwarderDomainType;\n                metaInfoType = systemInfo.metaInfoType;\n                relayerPaymentType = systemInfo.relayerPaymentType;\n                metaTransactionType = systemInfo.metaTransactionType;\n                loginDomainType = systemInfo.loginDomainType;\n                loginMessageType = systemInfo.loginMessageType;\n                loginDomainData = systemInfo.loginDomainData;\n                forwardRequestType = systemInfo.forwardRequestType;\n                forwarderDomainData = systemInfo.forwarderDomainData;\n                forwarderDomainDetails = systemInfo.forwarderDomainDetails;\n                trustedForwarderOverhead = systemInfo.overHeadEIP712Sign;\n                daiPermitOverhead = systemInfo.overHeadDaiPermit;\n                eip2612PermitOverhead = systemInfo.overHeadEIP2612Permit;\n                engine.forwarderAddress = systemInfo.biconomyForwarderAddress;\n                engine.forwarderAddresses = systemInfo.biconomyForwarderAddresses;\n                engine.erc20ForwarderAddress = systemInfo.erc20ForwarderAddress;\n                engine.transferHandlerAddress = systemInfo.transferHandlerAddress;\n                engine.daiTokenAddress = systemInfo.daiTokenAddress;\n                engine.usdtTokenAddress = systemInfo.usdtTokenAddress;\n                engine.usdcTokenAddress = systemInfo.usdcTokenAddress;\n                engine.TRUSTED_FORWARDER = systemInfo.trustedForwarderMetaTransaction;\n                engine.ERC20_FORWARDER = systemInfo.erc20ForwarderMetaTransaction;\n                engine.DEFAULT = systemInfo.defaultMetaTransaction;\n                engine.EIP712_SIGN = systemInfo.eip712Sign;\n                engine.PERSONAL_SIGN = systemInfo.personalSign;\n                engine.tokenGasPriceV1SupportedNetworks = systemInfo.tokenGasPriceV1SupportedNetworks;\n                engine.walletFactoryAddress = systemInfo.walletFactoryAddress;\n                engine.baseWalletAddress = systemInfo.baseWalletAddress;\n                engine.entryPointAddress = systemInfo.entryPointAddress;\n                engine.handlerAddress = systemInfo.handlerAddress;\n                daiDomainData.verifyingContract = engine.daiTokenAddress;\n\n                if (systemInfo.relayHubAddress) {\n                  domainData.verifyingContract = systemInfo.relayHubAddress;\n                }\n              } else {\n                return eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.INVALID_DATA, \"Could not get signature types from server. Contact Biconomy Team\"));\n              } // check if Valid trusted forwarder address is present from system info\n\n\n              if (engine.forwarderAddress && engine.forwarderAddress != \"\") {\n                //let supportedForwarders = engine.forwarderAddresses;\n                // prevent initialising it here as system info could return an array of forwarder addresses\n                biconomyForwarder = new ethers.Contract( //pick up first forwarder address from the array by default then attach to an address accordingly\n                engine.forwarderAddress, biconomyForwarderAbi, engine.ethersProvider);\n              } // Get dapps smart contract data from biconomy servers\n\n\n              var getDAppInfoAPI = \"\".concat(baseURL, \"/api/\").concat(config.version, \"/smart-contract\");\n              fetch(getDAppInfoAPI, getFetchOptions(\"GET\", apiKey)).then(function (response) {\n                return response.json();\n              }).then(function (result) {\n                if (!result && result.flag != 143) {\n                  return eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.SMART_CONTRACT_NOT_FOUND, \"Error getting smart contract for dappId \".concat(dappId)));\n                }\n\n                var smartContractList = result.smartContracts;\n\n                if (smartContractList && smartContractList.length > 0) {\n                  smartContractList.forEach(function (contract) {\n                    var contractInterface = new ethers.utils.Interface(JSON.parse(contract.abi));\n\n                    if (contract.type === config.SCW) {\n                      smartContractMetaTransactionMap[config.SCW] = contract.metaTransactionType;\n                      interfaceMap[config.SCW] = contractInterface;\n                      smartContractMap[config.SCW] = contract.abi;\n                    } else {\n                      smartContractMetaTransactionMap[contract.address.toLowerCase()] = contract.metaTransactionType;\n                      interfaceMap[contract.address.toLowerCase()] = contractInterface;\n                      smartContractMap[contract.address.toLowerCase()] = contract.abi;\n                    }\n                  });\n\n                  _logMessage(smartContractMetaTransactionMap);\n\n                  _checkUserLogin(engine, dappId);\n                } else {\n                  if (engine.strictMode) {\n                    engine.status = STATUS.NO_DATA;\n                    eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.SMART_CONTRACT_NOT_FOUND, \"No smart contract registered for dappId \".concat(dappId, \" on Mexa Dashboard\")));\n                  } else {\n                    _checkUserLogin(engine, dappId);\n                  }\n                }\n              })[\"catch\"](function (error) {\n                eventEmitter.emit(EVENTS.BICONOMY_ERROR, formatMessage(RESPONSE_CODES.ERROR_RESPONSE, \"Error while initializing Biconomy\"), error);\n              });\n            });\n\n          case 10:\n          case \"end\":\n            return _context16.stop();\n        }\n      }\n    }, _callee16);\n  }));\n  return _onNetworkId.apply(this, arguments);\n}\n\nfunction _checkUserLogin(_x32, _x33) {\n  return _checkUserLogin2.apply(this, arguments);\n}\n\nfunction _checkUserLogin2() {\n  _checkUserLogin2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee17(engine, dappId) {\n    return _regenerator[\"default\"].wrap(function _callee17$(_context17) {\n      while (1) {\n        switch (_context17.prev = _context17.next) {\n          case 0:\n            eventEmitter.emit(EVENTS.SMART_CONTRACT_DATA_READY, dappId, engine);\n\n          case 1:\n          case \"end\":\n            return _context17.stop();\n        }\n      }\n    }, _callee17);\n  }));\n  return _checkUserLogin2.apply(this, arguments);\n}\n\nBiconomy.prototype.isReady = function () {\n  return this.status === STATUS.BICONOMY_READY;\n};\n\nBiconomy.prototype.getUserAccount = /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6() {\n  return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return _getUserAccount(this);\n\n        case 2:\n          return _context6.abrupt(\"return\", _context6.sent);\n\n        case 3:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _callee6, this);\n}));\n\nfunction getFetchOptions(method, apiKey) {\n  return {\n    method: method,\n    headers: {\n      \"x-api-key\": apiKey,\n      \"Content-Type\": \"application/json;charset=utf-8\"\n    }\n  };\n}\n\nfunction formatMessage(code, message) {\n  return {\n    code: code,\n    message: message\n  };\n}\n/**\n * Single method to be used for logging purpose.\n *\n * @param {string} message Message to be logged\n */\n\n\nfunction _logMessage(message) {\n  if (config && config.logsEnabled && console.log) {\n    console.log(message);\n  }\n}\n\nmodule.exports = Biconomy;"],"mappings":"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"},"metadata":{},"sourceType":"script"}